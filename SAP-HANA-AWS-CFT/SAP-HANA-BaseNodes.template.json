{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "(0008) Deploy SAP HANA on AWS",
    "Parameters": {
        "VPCID": {
            "Description": "The existing Amazon VPC where you want to deploy SAP HANA.",
            "Type": "AWS::EC2::VPC::Id"
        },
        "HANASubnet": {
            "Type": "AWS::EC2::Subnet::Id",
            "Description": "The existing private subnet in your VPC where you want to deploy SAP HANA."
        },
        "DMZSubnet": {
            "Type": "AWS::EC2::Subnet::Id",
            "Description": "The existing public subnet in your VPC where you want to deploy the optional RDP instance."
        },
        "DomainName": {
            "Type": "String",
            "Description": "Name to use for fully qualified domain names.",
            "Default": "local"
        },
        "HANAMasterHostname": {
            "Type": "String",
            "Description": "Host name to use for SAP HANA master node (DNS short name).",
            "Default": "imdbmaster"
        },
        "HANAWorkerHostname": {
            "Type": "String",
            "Description": "Host name to use for SAP HANA worker node(s) (DNS short name).",
            "Default": "imdbworker"
        },
        "PrivateBucket": {
            "Description": "Main build bucket where templates and scripts are located.",
            "Type": "String",
            "Default": "aws-quickstart/quickstart-sap-hana"
        },
        "CustomStorageConfig": {
            "Description": "S3 location where custom storage configuration file is localted.",
            "Type": "String",
            "Default": "aws-quickstart/quickstart-sap-hana/scripts"
        },
        "Proxy": {
            "Description": "Proxy address for http access (e.g., http://xyz.abc.com:8080 or http://10.x.x.x:8080).",
            "Type": "String",
            "Default": ""
        },
        "KeyName": {
            "Type": "AWS::EC2::KeyPair::KeyName",
            "Default": "home",
            "Description": "Name of an existing Amazon EC2 key pair. All instances will launch with this key pair."
        },
        "HANAInstallMedia": {
            "Description": "Full path to Amazon S3 location of SAP HANA software files (e.g., s3://myhanabucket/sap-hana-sps11/).",
            "Type": "String",
            "Default": ""
        },
        "EnableLogging": {
            "Description": "Enable (Yes) or disable (No) logging with AWS CloudTrail and AWS Config.",
            "Default": "No",
            "Type": "String",
            "AllowedValues": [
                "Yes",
                "No"
            ]
        },
        "CloudTrailS3Bucket": {
            "Description": "Name of S3 bucket where AWS CloudTrail trails and AWS Config log files can be stored (e.g., mycloudtrail).",
            "Default": "",
            "Type": "String"
        },
        "AutoRecovery": {
            "Type": "String",
            "Description": "Enable (Yes) or disable (No) automatic recovery feature for SAP HANA nodes. Disable it for Dedicated Host Deployments",
            "Default": "Yes",
            "AllowedValues": [
                "Yes",
                "No"
            ]
        },
        "AWSEFS": {
            "Type": "String",
            "Description": "Use (Yes) or don't use (No) Amazon EFS for HANA shared file system.",
            "Default": "Yes",
            "AllowedValues": [
                "Yes",
                "No"
            ]
        },
        "Encryption": {
            "Type": "String",
            "Description": "Enable (Yes) or disable (No) encryption on EBS volumes.",
            "Default": "No",
            "AllowedValues": [
                "Yes",
                "No"
            ]
        },
        "VolumeTypeHanaData": {
            "Type": "String",
            "Description": "EBS volume type for SAP HANA Data: General Purpose SSD (gp2) or Provisioned IOPS SSD (io1).",
            "Default": "gp2",
            "AllowedValues": [
                "gp2",
                "io1"
            ]
        },
        "VolumeTypeHanaLog": {
            "Type": "String",
            "Description": "EBS volume type for SAP HANA Log: General Purpose SSD (gp2) or Provisioned IOPS SSD (io1).",
            "Default": "gp2",
            "AllowedValues": [
                "gp2",
                "io1"
            ]
        },
        "MyOS": {
            "Type": "String",
            "Description": "Operating system (SLES or RHEL) and version for master and worker nodes.",
            "Default": "SuSELinux12SP4ForSAP",
            "AllowedValues": [
                "RedHatLinux75ForSAP",
                "RedHatLinux74ForSAP-With-HA-US",
                "RedHatLinux75ForSAP-With-HA-US",
                "RedHatLinux76ForSAP-With-HA-US",
                "SuSELinux11SP4",
                "SuSELinux12SP1",
                "SuSELinux12SP3",
                "SuSELinux12SP4",
                "SuSELinux15",
                "SuSELinux12SP2ForSAP",
                "SuSELinux12SP3ForSAP",
                "SuSELinux12SP4ForSAP",
                "SuSELinux15ForSAP",
                "SuSELinux12SP1ForSAP-BYOS",
                "SuSELinux12SP2ForSAP-BYOS",
                "SuSELinux12SP3ForSAP-BYOS",
                "SuSELinux12SP4ForSAP-BYOS",
                "SuSELinux15ForSAP-BYOS"
            ]
        },
        "SLESBYOSRegCode": {
            "Type": "String",
            "Default": "",
            "Description": "Registration code for SUSE BYOS (Applicable only if you use BYOS Option).",
            "NoEcho": "true"
        },
        "InstallRDPInstance": {
            "Type": "String",
            "Description": "Install (Yes) or don't install (No) optional Windows RDP instance.",
            "Default": "No",
            "AllowedValues": [
                "Yes",
                "No"
            ]
        },
        "InstallHANA": {
            "Type": "String",
            "Description": "Install (Yes) or don't install (No) HANA. When set to No, only AWS infrastructure is provisioned.",
            "Default": "Yes",
            "AllowedValues": [
                "Yes",
                "No"
            ]
        },
        "RDPInstanceType": {
            "Type": "String",
            "Description": "Instance type for Windows RDP instance.",
            "Default": "c5.large",
            "AllowedValues": [
                "c4.large",
                "c4.xlarge",
                "c5.large",
                "c5.xlarge",
                "m4.large",
                "m4.xlarge",
                "m5.large",
                "m5.xlarge"
            ]
        },
        "MyInstanceType": {
            "Type": "String",
            "Description": "Instance type for SAP HANA host.",
            "Default": "r5.2xlarge",
            "AllowedValues": [
                "r3.8xlarge",
                "r3.4xlarge",
                "r3.2xlarge",
                "r4.16xlarge",
                "r4.8xlarge",
                "r4.4xlarge",
                "r4.2xlarge",
                "r5.2xlarge",
                "r5.4xlarge",
                "r5.12xlarge",
                "r5.24xlarge",
                "r5.metal",
                "x1.16xlarge",
                "x1.32xlarge",
                "x1e.xlarge",
                "x1e.2xlarge",
                "x1e.4xlarge",
                "x1e.32xlarge",
                "u-6tb1.metal",
                "u-9tb1.metal",
                "u-12tb1.metal",
                "u-18tb1.metal",
                "u-24tb1.metal"
            ]
        },
        "DedicatedHostId": {
            "Type": "CommaDelimitedList",
            "Description": "Existing dedicated host(s) where you want to launch your EC2 instance(s). Use comma to provide multiple hosts. Mandatory for Amazon EC2 High Memory Instances.",
            "Default": ""
        },
        "HostCount": {
            "Type": "Number",
            "Description": "Total number of SAP HANA nodes you want to deploy in the SAP HANA cluster.",
            "Default": "1",
            "MinValue": "1",
            "MaxValue": "5"
        },
        "SID": {
            "Type": "String",
            "Default": "HDB",
            "Description": "SAP HANA system ID for installation and setup.",
            "AllowedPattern": "([A-Z]{1}[0-9A-Z]{2})",
            "ConstraintDescription": "This value must consist of 3 characters."
        },
        "SAPInstanceNum": {
            "Type": "String",
            "Default": "00",
            "Description": "SAP HANA instance number to use for installation and setup, and to open ports for security groups.",
            "AllowedPattern": "([0-8]{1}[0-9]{1}|[9]{1}[0-7]{1})",
            "ConstraintDescription": "Instance number must be between 00 and 97."
        },
        "HANAMasterPass": {
            "Type": "String",
            "Description": "SAP HANA password to use during installation. Must be at least 8 characters with uppercase, lowercase, and numeric values.",
            "NoEcho": "true",
            "MinLength": "8",
            "AllowedPattern": "^(?=.*?[a-z])(?=.*?[A-Z])(?=.*[0-9]).*",
            "ConstraintDescription": "This must be at least 8 characters, including uppercase, lowercase, and numeric values."
        },
        "SAPTZ": {
            "AllowedValues": [
                "CT",
                "ET",
                "JT",
                "PT",
                "UC"
            ],
            "ConstraintDescription": "This value must consist of 2 characters.",
            "Default": "UC",
            "Description": "The TimeZone of your SAP HANA Server (PT, CT, ET, or UTC)",
            "Type": "String"
        },
        "LatestWS2012AmiId": {
            "Type": "AWS::SSM::Parameter::Value<AWS::EC2::Image::Id>",
            "Default": "/aws/service/ami-windows-latest/Windows_Server-2012-R2_RTM-English-64Bit-Base",
            "Description": "Do not change. Fetch latest Windows Server 2012 image id.",
            "AllowedValues": [
                "/aws/service/ami-windows-latest/Windows_Server-2012-R2_RTM-English-64Bit-Base"
            ]
        }
    },
    "Metadata": {
        "AWSAMIRegionMap": {
            "Filters": {
                "RHEL75SAPHVM": {
                    "name": "SAP-7.5_HVM_GA-????????-x86_64-0-Hourly2-GP2-b676039c-a4f8-4be7-9866-c804b1ade684-*",
                    "owner-alias": "aws-marketplace"
                },
                "RHEL74SAPHAUSHVM": {
                    "name": "SAPHAE4S-7.4_HVM-????????-x86_64-2-Hourly2-GP2-5cca0aac-b678-4e46-80e2-344cfed26a62-*",
                    "owner-alias": "aws-marketplace"
                },
                "RHEL75SAPHAUSHVM": {
                    "name": "SAPHAEUS-7.5_HVM-????????-x86_64-2-Hourly2-GP2-5cca0aac-b678-4e46-80e2-344cfed26a62-*",
                    "owner-alias": "aws-marketplace"
                },
                "RHEL76SAPHAUSHVM": {
                    "name": "SAP-7.6_E4S_HA_US_HVM-????????-x86_64-2-Hourly2-GP2-5cca0aac-b678-4e46-80e2-344cfed26a62-*",
                    "owner-alias": "aws-marketplace"
                },
                "SLES12SP2SAPHVM": {
                    "name": "*-e3458d64-5c36-4577-bd98-0ee19e3eaeec-*",
                    "owner-alias": "aws-marketplace"
                },
                "SLES12SP3SAPHVM": {
                    "name": "*-da7aa9c3-97db-4573-89a6-7fe7348d90b0-*",
                    "owner-alias": "aws-marketplace"
                },
                "SLES12SP4SAPHVM": {
                    "name": "*-8f7bb679-fb90-4446-aa80-9b6cfd834710-*",
                    "owner-alias": "aws-marketplace"
                },
                "SLES15SAPHVM": {
                    "name": "*-6a4bc5af-a084-4f96-8402-5cd249e9091d-*",
                    "owner-alias": "aws-marketplace"
                }
            }
        },
        "AWS::CloudFormation::Interface": {
            "ParameterGroups": [
                {
                    "Label": {
                        "default": "Existing network infrastructure details"
                    },
                    "Description": {
                        "default": ""
                    },
                    "Parameters": [
                        "VPCID",
                        "HANASubnet",
                        "DMZSubnet",
                        "10.0.1.0/24",
                        "10.0.2.0/24"
                    ]
                },
                {
                    "Label": {
                        "default": "Server and storage configuration"
                    },
                    "Description": {
                        "default": ""
                    },
                    "Parameters": [
                        "MyOS",
                        "SLESBYOSRegCode",
                        "MyInstanceType",
                        "HostCount",
                        "DedicatedHostId",
                        "AutoRecovery",
                        "KeyName",
                        "VolumeTypeHanaData",
                        "VolumeTypeHanaLog",
                        "AWSEFS",
                        "Encryption"
                    ]
                },
                {
                    "Label": {
                        "default": "SAP HANA database configuration"
                    },
                    "Description": {
                        "default": ""
                    },
                    "Parameters": [
                        "DomainName",
                        "HANAMasterHostname",
                        "HANAWorkerHostname",
                        "SID",
                        "SAPInstanceNum",
                        "HANAMasterPass",
                        "SAPTZ",
                        "HANAInstallMedia",
                        "InstallHANA"
                    ]
                },
                {
                    "Label": {
                        "default": "Optional configuration"
                    },
                    "Description": {
                        "default": ""
                    },
                    "Parameters": [
                        "InstallRDPInstance",
                        "RDPInstanceType",
                        "0.0.0.0/0",
                        "0.0.0.0/0",
                        "EnableLogging",
                        "CloudTrailS3Bucket",
                        "Proxy"
                    ]
                },
                {
                    "Label": {
                        "default": "Advanced configuration (Do not modify unless directed by AWS Support)"
                    },
                    "Description": {
                        "default": ""
                    },
                    "Parameters": [
                        "PrivateBucket",
                        "CustomStorageConfig",
                        "LatestWS2012AmiId"
                    ]
                }
            ],
            "ParameterLabels": {
                "VPCID": {
                    "default": "Choose VPC ID"
                },
                "10.0.1.0/24": {
                    "default": "Enter CIDR block for private subnet"
                },
                "DMZSubnet": {
                    "default": "Choose public subnet"
                },
                "10.0.2.0/24": {
                    "default": "Enter CIDR block for public subnet"
                },
                "HANASubnet": {
                    "default": "Choose private subnet"
                },
                "0.0.0.0/0": {
                    "default": "Enter CIDR block for RDP access"
                },
                "DomainName": {
                    "default": "Enter domain name"
                },
                "HANAMasterHostname": {
                    "default": "Enter SAP HANA master host name"
                },
                "HANAWorkerHostname": {
                    "default": "Enter SAP HANA worker host name"
                },
                "HANAInstallMedia": {
                    "default": "Enter Amazon S3 URL for SAP HANA software"
                },
                "CloudTrailS3Bucket": {
                    "default": "Enter S3 bucket name to store AWS CloudTrail trails and AWS Config logs"
                },
                "DedicatedHostId": {
                    "default": "Enter Dedicated Host ID"
                },
                "PrivateBucket": {
                    "default": "Enter private bucket"
                },
                "CustomStorageConfig": {
                    "default": "Enter custom storage configuration location"
                },
                "Proxy": {
                    "default": "Enter proxy server address"
                },
                "KeyName": {
                    "default": "Choose key pair"
                },
                "AutoRecovery": {
                    "default": "Would you like to turn on automatic recovery?"
                },
                "InstallRDPInstance": {
                    "default": "Do you need a Windows RDP instance?"
                },
                "InstallHANA": {
                    "default": "Install SAP HANA software?"
                },
                "AWSEFS": {
                    "default": "Would you like to use Amazon EFS?"
                },
                "Encryption": {
                    "default": "Would you like to turn on encryption?"
                },
                "VolumeTypeHanaData": {
                    "default": "Choose storage volume type for SAP HANA Data"
                },
                "VolumeTypeHanaLog": {
                    "default": "Choose storage volume type for SAP HANA Log"
                },
                "MyOS": {
                    "default": "Choose operating system for SAP HANA"
                },
                "SLESBYOSRegCode": {
                    "default": "Enter SUSE BYOS Registration Code"
                },
                "MyInstanceType": {
                    "default": "Choose instance type for SAP HANA"
                },
                "HostCount": {
                    "default": "Enter number of SAP HANA hosts"
                },
                "SID": {
                    "default": "Enter SAP HANA system ID"
                },
                "SAPInstanceNum": {
                    "default": "Enter SAP HANA instance number"
                },
                "HANAMasterPass": {
                    "default": "Enter SAP HANA password"
                },
                "RDPInstanceType": {
                    "default": "Choose instance type for RDP host"
                },
                "EnableLogging": {
                    "default": "Would you like to enable AWS CloudTrail trails and AWS Config?"
                },
                "SAPTZ": {
                    "default": "Enter SAP HANA Server timezone"
                },
                "0.0.0.0/0": {
                    "default": "Enter CIDR block of your SAP Application Servers"
                },
                "LatestWS2012AmiId": {
                    "default": "WS2012R2 AMI ID SSM Parameter"
                }
            }
        },
        "AWS::CloudFormation::Designer": {
            "d0cd4507-66d3-4b97-822d-388d2ccb5f02": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 60,
                    "y": 90
                },
                "z": 1,
                "embeds": []
            },
            "b7e0ac04-3eed-40c6-9b48-819c9fd2a529": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 180,
                    "y": 90
                },
                "z": 1,
                "embeds": []
            },
            "a8ea4255-20bb-403a-8936-015a0288ce10": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 60,
                    "y": 210
                },
                "z": 1,
                "embeds": []
            },
            "1d374371-bb03-4f29-bc8d-336f519c4637": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 180,
                    "y": 210
                },
                "z": 1,
                "embeds": []
            },
            "2584d35f-b5b6-4908-9b11-00380242e421": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 300,
                    "y": 90
                },
                "z": 1,
                "embeds": []
            },
            "622c357b-e28a-406a-82f9-f3122a4de661": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 300,
                    "y": 210
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "2584d35f-b5b6-4908-9b11-00380242e421"
                ]
            },
            "1b359f5f-7a21-4efc-ae7d-f347f95522be": {
                "source": {
                    "id": "1d374371-bb03-4f29-bc8d-336f519c4637"
                },
                "target": {
                    "id": "622c357b-e28a-406a-82f9-f3122a4de661"
                },
                "z": 1
            },
            "86b0acf3-f35e-49ed-a9fe-26548b785566": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 60,
                    "y": 330
                },
                "z": 1,
                "embeds": []
            },
            "d99f27d0-0083-4688-9470-4b1f6cf7f694": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 180,
                    "y": 330
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "86b0acf3-f35e-49ed-a9fe-26548b785566"
                ]
            },
            "8fdfa01a-7ba4-47e6-94bf-200e2df7d03b": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 300,
                    "y": 330
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "622c357b-e28a-406a-82f9-f3122a4de661"
                ]
            },
            "176958a9-5698-47fb-8be8-8402b988d717": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 420,
                    "y": 90
                },
                "z": 1,
                "embeds": []
            },
            "fd9c7ba3-4076-46e9-ad84-9092611da3c7": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 420,
                    "y": 210
                },
                "z": 1,
                "embeds": []
            },
            "67e54dc3-5f4e-49c0-aa1d-397e7cc0e42c": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 420,
                    "y": 330
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "fd9c7ba3-4076-46e9-ad84-9092611da3c7"
                ]
            },
            "1f23d89f-a552-4e6c-b96f-7e0374c275c2": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 60,
                    "y": 450
                },
                "z": 1,
                "embeds": []
            },
            "42283a2f-eefe-41d0-b37a-ac62bc0399d3": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 180,
                    "y": 450
                },
                "z": 1,
                "embeds": []
            },
            "2e0ba5e5-ae64-49c3-8e7c-857e1c7dc19f": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 300,
                    "y": 450
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "d0cd4507-66d3-4b97-822d-388d2ccb5f02",
                    "42283a2f-eefe-41d0-b37a-ac62bc0399d3"
                ]
            },
            "545758ad-8b48-414a-908b-b2f123366aad": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 420,
                    "y": 450
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "b7e0ac04-3eed-40c6-9b48-819c9fd2a529",
                    "42283a2f-eefe-41d0-b37a-ac62bc0399d3"
                ]
            },
            "6e5b6f8f-3d2b-45c2-8981-6d5d43cfe132": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 540,
                    "y": 90
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "1f23d89f-a552-4e6c-b96f-7e0374c275c2"
                ]
            },
            "c481cd63-2122-4d2e-94c8-a94996babd36": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 540,
                    "y": 210
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "1f23d89f-a552-4e6c-b96f-7e0374c275c2"
                ],
                "dependson": [
                    "6e5b6f8f-3d2b-45c2-8981-6d5d43cfe132"
                ]
            },
            "373d4d66-7b30-4dd1-9d95-dfe78140abef": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 540,
                    "y": 330
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "1f23d89f-a552-4e6c-b96f-7e0374c275c2"
                ]
            },
            "2f810518-7347-4f10-b2b8-b69d36ffcd7e": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 540,
                    "y": 450
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "1f23d89f-a552-4e6c-b96f-7e0374c275c2"
                ]
            },
            "4de8cfa0-cd15-4d5f-9810-712a2c49968e": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 60,
                    "y": 570
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "1f23d89f-a552-4e6c-b96f-7e0374c275c2"
                ]
            },
            "69f42c7e-10d3-4ea4-8ca4-081e9b551bbb": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 180,
                    "y": 570
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "42283a2f-eefe-41d0-b37a-ac62bc0399d3"
                ]
            },
            "b3ebc50a-56c5-475f-ac8b-1298ea2de55f": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 300,
                    "y": 570
                },
                "z": 1,
                "embeds": []
            },
            "6cfb46b6-f53f-40e1-8d63-de10912b7721": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 420,
                    "y": 570
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "6e5b6f8f-3d2b-45c2-8981-6d5d43cfe132"
                ]
            },
            "3edee7ff-a178-47bd-a6af-962be55f04dd": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 540,
                    "y": 570
                },
                "z": 1,
                "embeds": []
            },
            "4c6fedb8-6800-449a-9839-937ec36b7d04": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 660,
                    "y": 90
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "c481cd63-2122-4d2e-94c8-a94996babd36"
                ]
            },
            "9f6ff85c-30e3-4a31-8e39-c217eb35e989": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 660,
                    "y": 210
                },
                "z": 1,
                "embeds": []
            },
            "713627a4-eec6-4a97-81dc-4c3c625784e9": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 660,
                    "y": 330
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "373d4d66-7b30-4dd1-9d95-dfe78140abef"
                ]
            },
            "d17ec5e8-ea91-49c0-9996-ba328e256c69": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 660,
                    "y": 450
                },
                "z": 1,
                "embeds": []
            },
            "3dc685df-0fba-446f-b2e9-634d8ad37e1c": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 660,
                    "y": 570
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "2f810518-7347-4f10-b2b8-b69d36ffcd7e"
                ]
            },
            "871f8de6-5f62-41d2-bc26-161b2f7feeeb": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 60,
                    "y": 690
                },
                "z": 1,
                "embeds": []
            },
            "37c4e7fb-5cad-4d46-bd77-7302246e99c7": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 180,
                    "y": 690
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "4de8cfa0-cd15-4d5f-9810-712a2c49968e"
                ]
            },
            "7b1a2e66-4d5d-406a-9200-ffb65eb0cf6c": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 300,
                    "y": 690
                },
                "z": 1,
                "embeds": []
            },
            "bf00cdaf-6e90-4ff3-b161-f62f23f2b187": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 420,
                    "y": 690
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "69f42c7e-10d3-4ea4-8ca4-081e9b551bbb"
                ]
            },
            "72e4c90a-49fc-49b7-8b12-25d2ff717a19": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 540,
                    "y": 690
                },
                "z": 1,
                "embeds": []
            },
            "6abec30c-851d-483a-81a7-722fe286ac1a": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 660,
                    "y": 690
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "176958a9-5698-47fb-8be8-8402b988d717"
                ],
                "dependson": [
                    "bf00cdaf-6e90-4ff3-b161-f62f23f2b187"
                ]
            },
            "519f2ccd-3f89-4a71-ba6a-30c142f2b373": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 780,
                    "y": 90
                },
                "z": 1,
                "embeds": []
            },
            "b9d59526-0e94-4ef4-849a-804c1b5c738c": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 780,
                    "y": 210
                },
                "z": 1,
                "embeds": []
            },
            "6d6537cf-960b-4922-96ce-e032a0977bd2": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 780,
                    "y": 330
                },
                "z": 1,
                "embeds": []
            },
            "a4a74305-bd45-4b5d-a443-32afc6913192": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 780,
                    "y": 450
                },
                "z": 1,
                "embeds": []
            },
            "60c5cf72-d16a-402d-93ae-0d40b03e37e2": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 780,
                    "y": 570
                },
                "z": 1,
                "embeds": [],
                "dependson": [
                    "a4a74305-bd45-4b5d-a443-32afc6913192"
                ]
            },
            "2259dea7-b4db-4f86-a49b-baeb9bc86475": {
                "source": {
                    "id": "c481cd63-2122-4d2e-94c8-a94996babd36"
                },
                "target": {
                    "id": "6e5b6f8f-3d2b-45c2-8981-6d5d43cfe132"
                },
                "z": 2
            }
        }
    },
    "Conditions": {
        "TwoOrMoreNodes": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        "2",
                        {
                            "Ref": "HostCount"
                        }
                    ]
                },
                {
                    "Fn::Equals": [
                        "3",
                        {
                            "Ref": "HostCount"
                        }
                    ]
                },
                {
                    "Fn::Equals": [
                        "4",
                        {
                            "Ref": "HostCount"
                        }
                    ]
                },
                {
                    "Fn::Equals": [
                        "5",
                        {
                            "Ref": "HostCount"
                        }
                    ]
                },
                {
                    "Fn::Equals": [
                        "6",
                        {
                            "Ref": "HostCount"
                        }
                    ]
                }
            ]
        },
        "ThreeOrMoreNodes": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        "3",
                        {
                            "Ref": "HostCount"
                        }
                    ]
                },
                {
                    "Fn::Equals": [
                        "4",
                        {
                            "Ref": "HostCount"
                        }
                    ]
                },
                {
                    "Fn::Equals": [
                        "5",
                        {
                            "Ref": "HostCount"
                        }
                    ]
                },
                {
                    "Fn::Equals": [
                        "6",
                        {
                            "Ref": "HostCount"
                        }
                    ]
                }
            ]
        },
        "FourOrMoreNodes": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        "4",
                        {
                            "Ref": "HostCount"
                        }
                    ]
                },
                {
                    "Fn::Equals": [
                        "5",
                        {
                            "Ref": "HostCount"
                        }
                    ]
                },
                {
                    "Fn::Equals": [
                        "6",
                        {
                            "Ref": "HostCount"
                        }
                    ]
                }
            ]
        },
        "FiveOrMoreNodes": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        "5",
                        {
                            "Ref": "HostCount"
                        }
                    ]
                },
                {
                    "Fn::Equals": [
                        "6",
                        {
                            "Ref": "HostCount"
                        }
                    ]
                }
            ]
        },
        "SixOrMoreNodes": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        "6",
                        {
                            "Ref": "HostCount"
                        }
                    ]
                },
                {
                    "Fn::Equals": [
                        "7",
                        {
                            "Ref": "HostCount"
                        }
                    ]
                }
            ]
        },
        "AutoRecoveryWorker1": {
            "Fn::And": [
                {
                    "Fn::Equals": [
                        "Yes",
                        {
                            "Ref": "AutoRecovery"
                        }
                    ]
                },
                {
                    "Condition": "TwoOrMoreNodes"
                }
            ]
        },
        "AutoRecoveryWorker2": {
            "Fn::And": [
                {
                    "Fn::Equals": [
                        "Yes",
                        {
                            "Ref": "AutoRecovery"
                        }
                    ]
                },
                {
                    "Condition": "ThreeOrMoreNodes"
                }
            ]
        },
        "AutoRecoveryWorker3": {
            "Fn::And": [
                {
                    "Fn::Equals": [
                        "Yes",
                        {
                            "Ref": "AutoRecovery"
                        }
                    ]
                },
                {
                    "Condition": "FourOrMoreNodes"
                }
            ]
        },
        "AutoRecoveryWorker4": {
            "Fn::And": [
                {
                    "Fn::Equals": [
                        "Yes",
                        {
                            "Ref": "AutoRecovery"
                        }
                    ]
                },
                {
                    "Condition": "FiveOrMoreNodes"
                }
            ]
        },
        "AutoRecoveryWorker5": {
            "Fn::And": [
                {
                    "Fn::Equals": [
                        "Yes",
                        {
                            "Ref": "AutoRecovery"
                        }
                    ]
                },
                {
                    "Condition": "SixOrMoreNodes"
                }
            ]
        },
        "AutoRecoveryMaster": {
            "Fn::Equals": [
                {
                    "Ref": "AutoRecovery"
                },
                "Yes"
            ]
        },
        "NeedWindowsInstance": {
            "Fn::Equals": [
                {
                    "Ref": "InstallRDPInstance"
                },
                "Yes"
            ]
        },
        "UseEFS": {
            "Fn::Equals": [
                {
                    "Ref": "AWSEFS"
                },
                "Yes"
            ]
        },
        "NoUseEFS": {
            "Fn::Equals": [
                {
                    "Ref": "AWSEFS"
                },
                "No"
            ]
        },
        "UseEncryption": {
            "Fn::Equals": [
                {
                    "Ref": "Encryption"
                },
                "Yes"
            ]
        },
        "IfDedicatedHost": {
            "Fn::Not": [
                {
                    "Fn::Equals": [
                        {
                            "Fn::Select": [
                                "0",
                                {
                                    "Ref": "DedicatedHostId"
                                }
                            ]
                        },
                        ""
                    ]
                }
            ]
        },
        "IfLogging": {
            "Fn::Equals": [
                {
                    "Ref": "EnableLogging"
                },
                "Yes"
            ]
        },
        "IfAppSubnet": {
            "Fn::Not": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "0.0.0.0/0"
                        },
                        "0.0.0.0/0"
                    ]
                }
            ]
        },
        "IfUseSLES": {
            "Fn::Equals": [
                {
                    "Fn::FindInMap": [
                        "SAPAMINameMap",
                        {
                            "Ref": "MyOS"
                        },
                        "Code"
                    ]
                },
                "SLES"
            ]
        }
    },
    "Mappings": {
        "SAPAMINameMap": {
            "RedHatLinux75ForSAP": {
                "Code": "RHEL75SAPHVM"
            },
            "RedHatLinux74ForSAP-With-HA-US": {
                "Code": "RHEL74SAPHAUSHVM"
            },
            "RedHatLinux75ForSAP-With-HA-US": {
                "Code": "RHEL75SAPHAUSHVM"
            },
            "RedHatLinux76ForSAP-With-HA-US": {
                "Code": "RHEL76SAPHAUSHVM"
            },
            "SuSELinux11SP4": {
                "Code": "SLES11SP4HVM"
            },
            "SuSELinux12SP1": {
                "Code": "SLES12SP1HVM"
            },
            "SuSELinux12SP2": {
                "Code": "SLES12SP2HVM"
            },
            "SuSELinux12SP3": {
                "Code": "SLES12SP3HVM"
            },
            "SuSELinux12SP4": {
                "Code": "SLES12SP4HVM"
            },
            "SuSELinux15": {
                "Code": "SLES15HVM"
            },
            "SuSELinux12SP2ForSAP": {
                "Code": "SLES12SP2SAPHVM"
            },
            "SuSELinux12SP3ForSAP": {
                "Code": "SLES12SP3SAPHVM"
            },
            "SuSELinux12SP4ForSAP": {
                "Code": "SLES12SP4SAPHVM"
            },
            "SuSELinux15ForSAP": {
                "Code": "SLES15SAPHVM"
            },
            "SuSELinux12SP1ForSAP-BYOS": {
                "Code": "SLES12SP1SAPBYOSHVM"
            },
            "SuSELinux12SP2ForSAP-BYOS": {
                "Code": "SLES12SP2SAPBYOSHVM"
            },
            "SuSELinux12SP3ForSAP-BYOS": {
                "Code": "SLES12SP3SAPBYOSHVM"
            },
            "SuSELinux12SP4ForSAP-BYOS": {
                "Code": "SLES12SP4SAPBYOSHVM"
            },
            "SuSELinux15ForSAP-BYOS": {
                "Code": "SLES15SAPBYOSHVM"
            }
        },
        "AWSAMIRegionMap": {
            "AMI": {
                "RHEL75SAPHVM": "SAP-7.5_HVM_GA-20180911-x86_64-0-Hourly2-GP2-b676039c-a4f8-4be7-9866-c804b1ade684-ami-01e5a531ae8d3d976.4",
                "RHEL74SAPHAUSHVM": "SAPHAE4S-7.4_HVM-20181108-x86_64-2-Hourly2-GP2-5cca0aac-b678-4e46-80e2-344cfed26a62-ami-0c3e857ffeab71ac5.4",
                "RHEL75SAPHAUSHVM": "SAPHAEUS-7.5_HVM-20181108-x86_64-2-Hourly2-GP2-5cca0aac-b678-4e46-80e2-344cfed26a62-ami-081c0b27c08752050.4",
                "RHEL76SAPHAUSHVM": "SAP-7.6_E4S_HA_US_HVM-20190221-x86_64-2-Hourly2-GP2-5cca0aac-b678-4e46-80e2-344cfed26a62-ami-0e49c67162a6956e9.4",
                "SLES11SP4HVM": "suse-sles-11-sp4-v20180816-hvm-ssd-x86_64",
                "SLES12SP1HVM": "suse-sles-12-sp1-v20161021-hvm-ssd-x86_64",
                "SLES12SP2HVM": "suse-sles-12-sp2-v20170620-hvm-ssd-x86_64",
                "SLES12SP3HVM": "suse-sles-12-sp3-v20181004-hvm-ssd-x86_64",
                "SLES12SP4HVM": "suse-sles-12-sp4-v20190314-hvm-ssd-x86_64",
                "SLES15HVM": "suse-sles-15-v20180806-hvm-ssd-x86_64",
                "SLES12SP2SAPHVM": "suse-sles-sap-12-sp2-v20180706-hvm-ssd-x86_64-e3458d64-5c36-4577-bd98-0ee19e3eaeec-ami-3ac5ea45.4",
                "SLES12SP3SAPHVM": "suse-sles-sap-12-sp3-v20180814-hvm-ssd-x86_64-da7aa9c3-97db-4573-89a6-7fe7348d90b0-ami-0df5b06332b816a8e.4",
                "SLES12SP4SAPHVM": "suse-sles-sap-12-sp4-v20181212-hvm-ssd-x86_64-8f7bb679-fb90-4446-aa80-9b6cfd834710-ami-015bf44384c484ccb.4",
                "SLES15SAPHVM": "suse-sles-sap-15-v20180806-hvm-ssd-x86_64-6a4bc5af-a084-4f96-8402-5cd249e9091d-ami-06aee2e6db735d4f4.4",
                "SLES12SP1SAPBYOSHVM": "suse-sles-sap-12-sp1-byos-v20170123-hvm-ssd-x86_64",
                "SLES12SP2SAPBYOSHVM": "suse-sles-sap-12-sp2-byos-v20180816-hvm-ssd-x86_64",
                "SLES12SP3SAPBYOSHVM": "suse-sles-sap-12-sp3-byos-v20180814-hvm-ssd-x86_64",
                "SLES12SP4SAPBYOSHVM": "suse-sles-sap-12-sp4-byos-v20190314-hvm-ssd-x86_64",
                "SLES15SAPBYOSHVM": "suse-sles-sap-15-byos-v20180816-hvm-ssd-x86_64"
            },
            "ap-northeast-1": {
                "RHEL75SAPHVM": "ami-0ce47f39a0a21f61e",
                "RHEL74SAPHAUSHVM": "ami-0033f0d7d626f014f",
                "RHEL75SAPHAUSHVM": "ami-08d13c2bb0c07e8e3",
                "RHEL76SAPHAUSHVM": "ami-092eb64b443171d7e",
                "SLES11SP4HVM": "ami-0c6f393bb8d20159a",
                "SLES12SP1HVM": "ami-d94fe9b8",
                "SLES12SP1SAPBYOSHVM": "ami-63473c04",
                "SLES12SP2HVM": "ami-a07560c7",
                "SLES12SP2SAPBYOSHVM": "ami-0cd358eaaf4cfca8f",
                "SLES12SP2SAPHVM": "ami-0473f61d700f976bd",
                "SLES12SP3HVM": "ami-050f5170e43607893",
                "SLES12SP3SAPBYOSHVM": "ami-046ba88845aa11793",
                "SLES12SP3SAPHVM": "ami-0b8f8f9b74113860d",
                "SLES12SP4HVM": "ami-01f9388175dab7707",
                "SLES12SP4SAPBYOSHVM": "ami-0f23448ff16bda87c",
                "SLES12SP4SAPHVM": "ami-08b12d52001226654",
                "SLES15HVM": "ami-056ac8ad44e6a7e1f",
                "SLES15SAPHVM": "ami-0174751ba72376df1",
                "SLES15SAPBYOSHVM": "ami-0a283a879655ea8ad"
            },
            "ap-northeast-2": {
                "RHEL75SAPHVM": "ami-06db50be1842d6b9a",
                "RHEL74SAPHAUSHVM": "ami-0450ac5a5b079fa41",
                "RHEL75SAPHAUSHVM": "ami-0521b6ebbf151e58a",
                "RHEL76SAPHAUSHVM": "ami-04384779af6b49648",
                "SLES11SP4HVM": "ami-00e7068674ce94853",
                "SLES12SP1HVM": "ami-1ced3972",
                "SLES12SP1SAPBYOSHVM": "ami-b5f928db",
                "SLES12SP2HVM": "ami-86d00fe8",
                "SLES12SP2SAPBYOSHVM": "ami-0aa17e547c74ef870",
                "SLES12SP2SAPHVM": "ami-06156767035d49b64",
                "SLES12SP3HVM": "ami-00728f974fb4b3f2a",
                "SLES12SP3SAPBYOSHVM": "ami-0dae09c444db95f79",
                "SLES12SP3SAPHVM": "ami-0cef55a8a76f97f48",
                "SLES12SP4HVM": "ami-05114ac18a716bc1c",
                "SLES12SP4SAPBYOSHVM": "ami-028abd488e2c2f400",
                "SLES12SP4SAPHVM": "ami-08ec16a7528db036b",
                "SLES15HVM": "ami-0f81fff879bafe6b8",
                "SLES15SAPHVM": "ami-025bc5b179c7689f8",
                "SLES15SAPBYOSHVM": "ami-0cc04512ca5fb8d7c"
            },
            "ap-south-1": {
                "RHEL75SAPHVM": "ami-0afdd099cb4cacadf",
                "RHEL74SAPHAUSHVM": "ami-0167ffd4ebf2c034a",
                "RHEL75SAPHAUSHVM": "ami-029b2a9859384e194",
                "RHEL76SAPHAUSHVM": "ami-015afb3901ab40784",
                "SLES11SP4HVM": "ami-0bdb8670f707feabd",
                "SLES12SP1HVM": "ami-985226f7",
                "SLES12SP1SAPBYOSHVM": "ami-93c9bffc",
                "SLES12SP2HVM": "ami-62e39c0d",
                "SLES12SP2SAPBYOSHVM": "ami-074ee04de447633ed",
                "SLES12SP2SAPHVM": "ami-0d596f0cc53977008",
                "SLES12SP3HVM": "ami-0c1453eb750c7a5ab",
                "SLES12SP3SAPBYOSHVM": "ami-00831fe0c42624267",
                "SLES12SP3SAPHVM": "ami-01a3814eefe8a1697",
                "SLES12SP4HVM": "ami-0e2520e97af25d4d2",
                "SLES12SP4SAPBYOSHVM": "ami-05651b45e99d63d02",
                "SLES12SP4SAPHVM": "ami-0e6f4e89109d8243d",
                "SLES15HVM": "ami-01be89269d32f2a16",
                "SLES15SAPHVM": "ami-01a38e853e458e7e4",
                "SLES15SAPBYOSHVM": "ami-0d5612595295301aa"
            },
            "ap-southeast-1": {
                "RHEL75SAPHVM": "ami-08fc0673d9d83037a",
                "RHEL74SAPHAUSHVM": "ami-037dc0ec600ed1888",
                "RHEL75SAPHAUSHVM": "ami-05c8713dd14fa6156",
                "RHEL76SAPHAUSHVM": "ami-0469d4463a41ed704",
                "SLES11SP4HVM": "ami-021e49892145e1949",
                "SLES12SP1HVM": "ami-163d9b75",
                "SLES12SP1SAPBYOSHVM": "ami-ab0aa0c8",
                "SLES12SP2HVM": "ami-f1078a92",
                "SLES12SP2SAPBYOSHVM": "ami-0c5d434c11072f709",
                "SLES12SP2SAPHVM": "ami-00a5e8e37caec221a",
                "SLES12SP3HVM": "ami-06190570cf455031a",
                "SLES12SP3SAPBYOSHVM": "ami-0a91084c1447100ed",
                "SLES12SP3SAPHVM": "ami-048491051c0ad3dda",
                "SLES12SP4HVM": "ami-05a7bd74a593452d7",
                "SLES12SP4SAPBYOSHVM": "ami-07bae09461b7a3942",
                "SLES12SP4SAPHVM": "ami-01fc893705c4e053e",
                "SLES15HVM": "ami-070356c21596ddc67",
                "SLES15SAPHVM": "ami-0b312f69647b63e0e",
                "SLES15SAPBYOSHVM": "ami-0701f0c9a5e645fe6"
            },
            "ap-southeast-2": {
                "RHEL75SAPHVM": "ami-0a8af8e94f35319ba",
                "RHEL74SAPHAUSHVM": "ami-0c5b5357081c68218",
                "RHEL75SAPHAUSHVM": "ami-0df9dbd4828ca1166",
                "RHEL76SAPHAUSHVM": "ami-0356eb53cb824dc7e",
                "SLES11SP4HVM": "ami-0c966540b7cd84b4b",
                "SLES12SP1HVM": "ami-e32b1680",
                "SLES12SP1SAPBYOSHVM": "ami-460d0a25",
                "SLES12SP2HVM": "ami-197a6a7a",
                "SLES12SP2SAPBYOSHVM": "ami-0e9b31a7f29df983d",
                "SLES12SP2SAPHVM": "ami-088ed61b6ad3a7a31",
                "SLES12SP3HVM": "ami-0ccbc8eb74e84b8bd",
                "SLES12SP3SAPBYOSHVM": "ami-0a22e7733b93a13cd",
                "SLES12SP3SAPHVM": "ami-0f8fa01e74ddf4994",
                "SLES12SP4HVM": "ami-0086939d81dda5418",
                "SLES12SP4SAPBYOSHVM": "ami-0de01b6abc06547bb",
                "SLES12SP4SAPHVM": "ami-09a3413dab4ad515e",
                "SLES15HVM": "ami-0c4245381c67efb39",
                "SLES15SAPHVM": "ami-0c995271948cbb736",
                "SLES15SAPBYOSHVM": "ami-0f5b781af42cbfa1e"
            },
            "ca-central-1": {
                "RHEL75SAPHVM": "ami-010ef109ec0f43d6d",
                "RHEL74SAPHAUSHVM": "ami-06e94c1c4cd754fe5",
                "RHEL75SAPHAUSHVM": "ami-0173442cbf82d3d9f",
                "RHEL76SAPHAUSHVM": "ami-0c720e8ded4a6c5b0",
                "SLES11SP4HVM": "ami-0a89186e8d2b82307",
                "SLES12SP1SAPBYOSHVM": "ami-2fd4694b",
                "SLES12SP2HVM": "ami-d5d56ab1",
                "SLES12SP2SAPBYOSHVM": "ami-06c5c26336f743bf6",
                "SLES12SP2SAPHVM": "ami-0b69394414a77d27d",
                "SLES12SP3HVM": "ami-0f7c9a39e20a9adea",
                "SLES12SP3SAPBYOSHVM": "ami-0bfb8d54b1407c64a",
                "SLES12SP3SAPHVM": "ami-09e101dc35e3dd223",
                "SLES12SP4HVM": "ami-00ff1fa0fb4b09437",
                "SLES12SP4SAPBYOSHVM": "ami-07735575a65d9748f",
                "SLES12SP4SAPHVM": "ami-0c1765e15fc9f78cc",
                "SLES15HVM": "ami-0c97d9b588207dad6",
                "SLES15SAPHVM": "ami-07d033739f020a039",
                "SLES15SAPBYOSHVM": "ami-08eec3db50798a295"
            },
            "eu-central-1": {
                "RHEL75SAPHVM": "ami-0841ec948df565271",
                "RHEL74SAPHAUSHVM": "ami-0a38565bcb3243da0",
                "RHEL75SAPHAUSHVM": "ami-08f1018e2a0f26daa",
                "RHEL76SAPHAUSHVM": "ami-00e9db6661b279d3f",
                "SLES11SP4HVM": "ami-0f032693ef4319469",
                "SLES12SP1HVM": "ami-59699036",
                "SLES12SP1SAPBYOSHVM": "ami-4b6ba424",
                "SLES12SP2HVM": "ami-984ee9f7",
                "SLES12SP2SAPBYOSHVM": "ami-07966002b34bab5f7",
                "SLES12SP2SAPHVM": "ami-026230d85941a84a8",
                "SLES12SP3HVM": "ami-0fa9bde3f3d40e5ae",
                "SLES12SP3SAPBYOSHVM": "ami-088e91696b7dcd30c",
                "SLES12SP3SAPHVM": "ami-0ab2953d28a3069fe",
                "SLES12SP4HVM": "ami-00f695136e33f2fe0",
                "SLES12SP4SAPBYOSHVM": "ami-0e6f5d8c7423fbf99",
                "SLES12SP4SAPHVM": "ami-0ad0e6f64464f6714",
                "SLES15HVM": "ami-05dfd265ea534a3e9",
                "SLES15SAPHVM": "ami-0823a4f2cd6f5ff6c",
                "SLES15SAPBYOSHVM": "ami-0c3196786bb2ef35a"
            },
            "eu-west-1": {
                "RHEL75SAPHVM": "ami-04a014a7d626b3fd8",
                "RHEL74SAPHAUSHVM": "ami-0af3e97778546f34b",
                "RHEL75SAPHAUSHVM": "ami-0dfa47f27b3bf9922",
                "RHEL76SAPHAUSHVM": "ami-0e39a11a4694e879d",
                "SLES11SP4HVM": "ami-0a40ff0e3202c10e1",
                "SLES12SP1HVM": "ami-b197d9c2",
                "SLES12SP1SAPBYOSHVM": "ami-81025de7",
                "SLES12SP2HVM": "ami-f5776f93",
                "SLES12SP2SAPBYOSHVM": "ami-083a4aebd9d24276c",
                "SLES12SP2SAPHVM": "ami-07cd573b3c20fdc08",
                "SLES12SP3HVM": "ami-06bc7889ee68f279e",
                "SLES12SP3SAPBYOSHVM": "ami-0461814360323e368",
                "SLES12SP3SAPHVM": "ami-04d42962dc1318ffa",
                "SLES12SP4HVM": "ami-0b27edba737a4a44a",
                "SLES12SP4SAPBYOSHVM": "ami-0a850f691a934ad5e",
                "SLES12SP4SAPHVM": "ami-0fd5f466cb98894a7",
                "SLES15HVM": "ami-0a58a1b152ba55f1d",
                "SLES15SAPHVM": "ami-0fda5e832418d2123",
                "SLES15SAPBYOSHVM": "ami-032a80d78e21d81a3"
            },
            "eu-west-2": {
                "RHEL75SAPHVM": "ami-070b8ef548695f653",
                "RHEL74SAPHAUSHVM": "ami-005b4b0f0decc3229",
                "RHEL75SAPHAUSHVM": "ami-0d24c16fec55a94f4",
                "RHEL76SAPHAUSHVM": "ami-0aeabd574eb91aa0b",
                "SLES11SP4HVM": "ami-06a87787f9466fa7b",
                "SLES12SP1SAPBYOSHVM": "ami-b2a1abd6",
                "SLES12SP2HVM": "ami-d97066bd",
                "SLES12SP2SAPBYOSHVM": "ami-0e77c12686f306f46",
                "SLES12SP2SAPHVM": "ami-05efc0a082a46f7e1",
                "SLES12SP3HVM": "ami-0eb4bd78fba2f32e4",
                "SLES12SP3SAPBYOSHVM": "ami-04e2fe477c0a1411f",
                "SLES12SP3SAPHVM": "ami-0dd1a88871a7960fa",
                "SLES12SP4HVM": "ami-01016d5a2f759e80e",
                "SLES12SP4SAPBYOSHVM": "ami-0ac859e29f5094204",
                "SLES12SP4SAPHVM": "ami-0ff4cabd1259cddfd",
                "SLES15HVM": "ami-01497522185aaa4ee",
                "SLES15SAPHVM": "ami-060b2e1e236b73f00",
                "SLES15SAPBYOSHVM": "ami-06f2df89214f6ead9"
            },
            "eu-west-3": {
                "RHEL75SAPHVM": "ami-0b9d6c1ae0e94e8a9",
                "RHEL74SAPHAUSHVM": "ami-01f114d111cc45831",
                "RHEL75SAPHAUSHVM": "ami-0d0e00736cd23369b",
                "RHEL76SAPHAUSHVM": "ami-0c1cf4ecf66e353e8",
                "SLES11SP4HVM": "ami-036671c4b09355867",
                "SLES12SP1SAPBYOSHVM": "ami-cf992eb2",
                "SLES12SP2SAPBYOSHVM": "ami-0664ede0d13c0c473",
                "SLES12SP2SAPHVM": "ami-051cfee36f46b2f73",
                "SLES12SP3HVM": "ami-07b20332d54ed21e8",
                "SLES12SP3SAPBYOSHVM": "ami-033b4942a6ba88005",
                "SLES12SP3SAPHVM": "ami-01cbec7515c17c466",
                "SLES12SP4HVM": "ami-077db4bb21fe102b3",
                "SLES12SP4SAPBYOSHVM": "ami-0c63b2bb6afc549b4",
                "SLES12SP4SAPHVM": "ami-0a004ab2ecfdfb1bc",
                "SLES15HVM": "ami-0f238bd4c6fdbefb0",
                "SLES15SAPHVM": "ami-0a10a689c47a8a6af",
                "SLES15SAPBYOSHVM": "ami-0f842e919e4e4eb6a"
            },
            "sa-east-1": {
                "RHEL75SAPHVM": "ami-0a9ee704defec0845",
                "RHEL74SAPHAUSHVM": "ami-04450cf66c6bf5f42",
                "RHEL75SAPHAUSHVM": "ami-0fb635cae4f8c6028",
                "RHEL76SAPHAUSHVM": "ami-0c60751a062c4295b",
                "SLES11SP4HVM": "ami-00134f83806a20f4a",
                "SLES12SP1HVM": "ami-ce3aa7a2",
                "SLES12SP1SAPBYOSHVM": "ami-eb543187",
                "SLES12SP2HVM": "ami-52a4cf3e",
                "SLES12SP2SAPBYOSHVM": "ami-046181f67382fdd53",
                "SLES12SP2SAPHVM": "ami-09d9d6c5c06d8a320",
                "SLES12SP3HVM": "ami-0188b2a9dc0ae5f44",
                "SLES12SP3SAPBYOSHVM": "ami-0ec3fee2bd8133f91",
                "SLES12SP3SAPHVM": "ami-020ab250cd2edee07",
                "SLES12SP4HVM": "ami-022eaa5bbc1e2f47a",
                "SLES12SP4SAPBYOSHVM": "ami-0451db96691925d3b",
                "SLES12SP4SAPHVM": "ami-0137ba6d20f42569d",
                "SLES15HVM": "ami-0772af912976aa692",
                "SLES15SAPHVM": "ami-0867633aaf95b8b45",
                "SLES15SAPBYOSHVM": "ami-0a374c04d3223b56d"
            },
            "us-east-1": {
                "RHEL75SAPHVM": "ami-05cd8f1730c8df7dc",
                "RHEL74SAPHAUSHVM": "ami-0f458a41a777ef497",
                "RHEL75SAPHAUSHVM": "ami-0d81d8964ccf8bdef",
                "RHEL76SAPHAUSHVM": "ami-054a9dc6c144331a0",
                "SLES11SP4HVM": "ami-05b47745292b62b8e",
                "SLES12SP1HVM": "ami-1eeab909",
                "SLES12SP1SAPBYOSHVM": "ami-7dd2256b",
                "SLES12SP2HVM": "ami-8fac8399",
                "SLES12SP2SAPBYOSHVM": "ami-006668674e5150470",
                "SLES12SP2SAPHVM": "ami-03032964354d05e9c",
                "SLES12SP3HVM": "ami-03adb8813ffd80f0b",
                "SLES12SP3SAPBYOSHVM": "ami-09e515a2f58fc7a93",
                "SLES12SP3SAPHVM": "ami-03f4b359c63c12d83",
                "SLES12SP4HVM": "ami-0787571b4033204ad",
                "SLES12SP4SAPBYOSHVM": "ami-0f9b20b9789585aa4",
                "SLES12SP4SAPHVM": "ami-057832816bd4496b3",
                "SLES15HVM": "ami-0b1764f3d7d2e2316",
                "SLES15SAPHVM": "ami-034a4657781cac699",
                "SLES15SAPBYOSHVM": "ami-0b335002243e5a9ff"
            },
            "us-east-2": {
                "RHEL75SAPHVM": "ami-0b1439383ea0d0c87",
                "RHEL74SAPHAUSHVM": "ami-0cfab53d572d62388",
                "RHEL75SAPHAUSHVM": "ami-03527d73c82921684",
                "RHEL76SAPHAUSHVM": "ami-02bf9176554430b2a",
                "SLES11SP4HVM": "ami-0d984fc673fefcb8c",
                "SLES12SP1HVM": "ami-85075de0",
                "SLES12SP1SAPBYOSHVM": "ami-ac2401c9",
                "SLES12SP2HVM": "ami-f990b69c",
                "SLES12SP2SAPBYOSHVM": "ami-0312e837f2f3e7ed3",
                "SLES12SP2SAPHVM": "ami-062d128e25a4979c2",
                "SLES12SP3HVM": "ami-0479b39f2d07530fb",
                "SLES12SP3SAPBYOSHVM": "ami-03dcbd3a0a73c3e1c",
                "SLES12SP3SAPHVM": "ami-077daf5b4eb744e5c",
                "SLES12SP4HVM": "ami-0f24364ccc4040c21",
                "SLES12SP4SAPBYOSHVM": "ami-0b4e01a990b03a9ae",
                "SLES12SP4SAPHVM": "ami-0458e523e4d3498f8",
                "SLES15HVM": "ami-05ea824317ffc0c20",
                "SLES15SAPHVM": "ami-0ad6708faee9090ba",
                "SLES15SAPBYOSHVM": "ami-00ee7014fa39c34cd"
            },
            "us-west-1": {
                "RHEL75SAPHVM": "ami-015c680b92b8f8e04",
                "RHEL74SAPHAUSHVM": "ami-0bce690da8c3f9573",
                "RHEL75SAPHAUSHVM": "ami-09294cb9917bcb535",
                "RHEL76SAPHAUSHVM": "ami-05163897ae5e64145",
                "SLES11SP4HVM": "ami-07db9616cb48eef6e",
                "SLES12SP1HVM": "ami-a12962c1",
                "SLES12SP1SAPBYOSHVM": "ami-4a9dcf2a",
                "SLES12SP2HVM": "ami-32c8e552",
                "SLES12SP2SAPBYOSHVM": "ami-039ae8bf416dc3bde",
                "SLES12SP2SAPHVM": "ami-01617594940e3550e",
                "SLES12SP3HVM": "ami-05561250b8346a707",
                "SLES12SP3SAPBYOSHVM": "ami-0f7b3754a9689ddfa",
                "SLES12SP3SAPHVM": "ami-0095e76cf1280c061",
                "SLES12SP4HVM": "ami-0afb3187a37661b18",
                "SLES12SP4SAPBYOSHVM": "ami-04e84846cf5b2eceb",
                "SLES12SP4SAPHVM": "ami-0d51a3027d6c22a27",
                "SLES15HVM": "ami-00e34a7624e5a7107",
                "SLES15SAPHVM": "ami-0867f45fee8435a19",
                "SLES15SAPBYOSHVM": "ami-039fb1d14e2287565"
            },
            "us-west-2": {
                "RHEL75SAPHVM": "ami-07894ab0a4a5e8612",
                "RHEL74SAPHAUSHVM": "ami-050890ecc1851620c",
                "RHEL75SAPHAUSHVM": "ami-07f49a6a84d94211e",
                "RHEL76SAPHAUSHVM": "ami-0062814abe5ca3369",
                "SLES11SP4HVM": "ami-09a652af9ed1e0dad",
                "SLES12SP1HVM": "ami-7fa2061f",
                "SLES12SP1SAPBYOSHVM": "ami-68922c08",
                "SLES12SP2HVM": "ami-da786da3",
                "SLES12SP2SAPBYOSHVM": "ami-057a6cd34fc874a04",
                "SLES12SP2SAPHVM": "ami-0e81e312127e49ae0",
                "SLES12SP3HVM": "ami-015ee9a0398544b09",
                "SLES12SP3SAPBYOSHVM": "ami-02df08fd0856d266b",
                "SLES12SP3SAPHVM": "ami-093d9dce64af94d34",
                "SLES12SP4HVM": "ami-0a3c873f21d686544",
                "SLES12SP4SAPBYOSHVM": "ami-042663489704d9c3f",
                "SLES12SP4SAPHVM": "ami-0d28ddb801d9589f0",
                "SLES15HVM": "ami-0f1e3b3fb0fec0361",
                "SLES15SAPHVM": "ami-0ca00995da6bbdea0",
                "SLES15SAPBYOSHVM": "ami-08c05da8c43e5091a"
            }
        }
    },
    "Outputs": {
        "HANAMasterInstanceIP": {
            "Description": "HANA Master Node IP Address",
            "Value": {
                "Fn::GetAtt": [
                    "HANAMasterInstance",
                    "PrivateIp"
                ]
            }
        },
        "HANAMasterSecurityGroup": {
            "Description": "Security Group created for the SAP HANA Master node",
            "Value": {
                "Fn::GetAtt": [
                    "HANASecurityGroup",
                    "GroupId"
                ]
            }
        },
        "HANAMasterInstanceRole": {
            "Description": "Instance Role Name for HANA Instance",
            "Value": {
                "Ref": "HANAIAMRole"
            }
        },
        "HANAMasterInstanceId": {
            "Description": "Instance Id for HANA Instance",
            "Value": {
                "Ref": "HANAMasterInstance"
            }
        }
    },
    "Resources": {
        "Trail": {
            "DependsOn": [
                "BucketPolicy"
            ],
            "Type": "AWS::CloudTrail::Trail",
            "Condition": "IfLogging",
            "Properties": {
                "IncludeGlobalServiceEvents": "true",
                "S3BucketName": {
                    "Ref": "CloudTrailS3Bucket"
                },
                "SnsTopicName": {
                    "Ref": "AWS::NoValue"
                },
                "IsLogging": "true"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "60c5cf72-d16a-402d-93ae-0d40b03e37e2"
                }
            }
        },
        "BucketPolicy": {
            "Type": "AWS::S3::BucketPolicy",
            "Condition": "IfLogging",
            "Properties": {
                "Bucket": {
                    "Ref": "CloudTrailS3Bucket"
                },
                "PolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Sid": "AWSCloudTrailAclCheck20150319",
                            "Effect": "Allow",
                            "Principal": {
                                "Service": "cloudtrail.amazonaws.com"
                            },
                            "Action": "s3:GetBucketAcl",
                            "Resource": {
                                "Fn::Join": [
                                    "",
                                    [
                                        "arn:aws:s3:::",
                                        {
                                            "Ref": "CloudTrailS3Bucket"
                                        }
                                    ]
                                ]
                            }
                        },
                        {
                            "Sid": "AWSCloudTrailWrite20150319",
                            "Effect": "Allow",
                            "Principal": {
                                "Service": "cloudtrail.amazonaws.com"
                            },
                            "Action": "s3:PutObject",
                            "Resource": {
                                "Fn::Join": [
                                    "",
                                    [
                                        "arn:aws:s3:::",
                                        {
                                            "Ref": "CloudTrailS3Bucket"
                                        },
                                        "/AWSLogs/",
                                        {
                                            "Ref": "AWS::AccountId"
                                        },
                                        "/*"
                                    ]
                                ]
                            },
                            "Condition": {
                                "StringEquals": {
                                    "s3:x-amz-acl": "bucket-owner-full-control"
                                }
                            }
                        },
                        {
                            "Sid": "AWSConfigBucketPermissionsCheck",
                            "Effect": "Allow",
                            "Principal": {
                                "Service": [
                                    "config.amazonaws.com"
                                ]
                            },
                            "Action": "s3:GetBucketAcl",
                            "Resource": {
                                "Fn::Join": [
                                    "",
                                    [
                                        "arn:aws:s3:::",
                                        {
                                            "Ref": "CloudTrailS3Bucket"
                                        }
                                    ]
                                ]
                            }
                        },
                        {
                            "Sid": " AWSConfigBucketDelivery",
                            "Effect": "Allow",
                            "Principal": {
                                "Service": [
                                    "config.amazonaws.com"
                                ]
                            },
                            "Action": "s3:PutObject",
                            "Resource": {
                                "Fn::Join": [
                                    "",
                                    [
                                        "arn:aws:s3:::",
                                        {
                                            "Ref": "CloudTrailS3Bucket"
                                        },
                                        "/AWSLogs/",
                                        {
                                            "Ref": "AWS::AccountId"
                                        },
                                        "/Config/*"
                                    ]
                                ]
                            },
                            "Condition": {
                                "StringEquals": {
                                    "s3:x-amz-acl": "bucket-owner-full-control"
                                }
                            }
                        }
                    ]
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "a4a74305-bd45-4b5d-a443-32afc6913192"
                }
            }
        },
        "ConfigRecorder": {
            "DependsOn": [
                "AWSConfigIAMRole"
            ],
            "Type": "AWS::Config::ConfigurationRecorder",
            "Condition": "IfLogging",
            "Properties": {
                "Name": "HANAQuickStart-ConfigRecord",
                "RecordingGroup": {
                    "ResourceTypes": [
                        "AWS::S3::Bucket",
                        "AWS::CloudTrail::Trail",
                        "AWS::EC2::Instance",
                        "AWS::EC2::SecurityGroup",
                        "AWS::EC2::NetworkInterface",
                        "AWS::EC2::Volume",
                        "AWS::EC2::VPC",
                        "AWS::EC2::Subnet",
                        "AWS::EC2::RouteTable",
                        "AWS::EC2::NetworkAcl"
                    ]
                },
                "RoleARN": {
                    "Fn::GetAtt": [
                        "AWSConfigIAMRole",
                        "Arn"
                    ]
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "6d6537cf-960b-4922-96ce-e032a0977bd2"
                }
            }
        },
        "DeliveryChannel": {
            "Type": "AWS::Config::DeliveryChannel",
            "Condition": "IfLogging",
            "Properties": {
                "ConfigSnapshotDeliveryProperties": {
                    "DeliveryFrequency": "One_Hour"
                },
                "S3BucketName": {
                    "Ref": "CloudTrailS3Bucket"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "b9d59526-0e94-4ef4-849a-804c1b5c738c"
                }
            }
        },
        "AWSConfigIAMRole": {
            "Type": "AWS::IAM::Role",
            "Condition": "IfLogging",
            "Properties": {
                "Path": "/",
                "ManagedPolicyArns": [
                    "arn:aws:iam::aws:policy/service-role/AWSConfigRole"
                ],
                "AssumeRolePolicyDocument": {
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Principal": {
                                "Service": [
                                    "config.amazonaws.com"
                                ]
                            },
                            "Action": [
                                "sts:AssumeRole"
                            ]
                        }
                    ]
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "519f2ccd-3f89-4a71-ba6a-30c142f2b373"
                }
            }
        },
        "DeploymentInterruptQ": {
            "Type": "AWS::SQS::Queue",
            "Properties": {
                "DelaySeconds": 0,
                "VisibilityTimeout": 0
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "b3ebc50a-56c5-475f-ac8b-1298ea2de55f"
                }
            }
        },
        "HANAMasterInterface": {
            "Type": "AWS::EC2::NetworkInterface",
            "Properties": {
                "Description": "Network Interface for HANA Master",
                "SubnetId": {
                    "Ref": "HANASubnet"
                },
                "GroupSet": [
                    {
                        "Ref": "HANASecurityGroup"
                    }
                ],
                "SourceDestCheck": "true",
                "Tags": [
                    {
                        "Key": "Network",
                        "Value": "Private"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "69f42c7e-10d3-4ea4-8ca4-081e9b551bbb"
                }
            }
        ,
        "HANAWorker1Interface": {
            "Type": "AWS::EC2::NetworkInterface",
            "Condition": "TwoOrMoreNodes",
            "Properties": {
                "SubnetId": {
                    "Ref": "HANASubnet"
                },
                "Description": "Interface for HANA Worker 1",
                "GroupSet": [
                    {
                        "Ref": "HANASlaveSG"
                    }
                ],
                "SourceDestCheck": "true",
                "Tags": [
                    {
                        "Key": "Network",
                        "Value": "Private"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "4de8cfa0-cd15-4d5f-9810-712a2c49968e"
                }
            }
        },
        "HANAWorker2Interface": {
            "Type": "AWS::EC2::NetworkInterface",
            "Condition": "ThreeOrMoreNodes",
            "Properties": {
                "SubnetId": {
                    "Ref": "HANASubnet"
                },
                "Description": "Interface for HANA Worker 2",
                "GroupSet": [
                    {
                        "Ref": "HANASlaveSG"
                    }
                ],
                "SourceDestCheck": "true",
                "Tags": [
                    {
                        "Key": "Network",
                        "Value": "Private"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "2f810518-7347-4f10-b2b8-b69d36ffcd7e"
                }
            }
        },
        "HANAWorker3Interface": {
            "Type": "AWS::EC2::NetworkInterface",
            "Condition": "FourOrMoreNodes",
            "Properties": {
                "SubnetId": {
                    "Ref": "HANASubnet"
                },
                "Description": "Interface for HANA Worker 3",
                "GroupSet": [
                    {
                        "Ref": "HANASlaveSG"
                    }
                ],
                "SourceDestCheck": "true",
                "Tags": [
                    {
                        "Key": "Network",
                        "Value": "Private"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "373d4d66-7b30-4dd1-9d95-dfe78140abef"
                }
            }
        },
        "HANAWorker4Interface": {
            "Type": "AWS::EC2::NetworkInterface",
            "Condition": "FiveOrMoreNodes",
            "Properties": {
                "SubnetId": {
                    "Ref": "HANASubnet"
                },
                "Description": "Interface for HANA Worker 4",
                "GroupSet": [
                    {
                        "Ref": "HANASlaveSG"
                    }
                ],
                "SourceDestCheck": "true",
                "Tags": [
                    {
                        "Key": "Network",
                        "Value": "Private"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "c481cd63-2122-4d2e-94c8-a94996babd36"
                }
            },
            "DependsOn": [
                "HANAWorker5Interface"
            ]
        },
        "HANAWorker5Interface": {
            "Type": "AWS::EC2::NetworkInterface",
            "Condition": "SixOrMoreNodes",
            "Properties": {
                "SubnetId": {
                    "Ref": "HANASubnet"
                },
                "Description": "Interface for HANA Worker 5",
                "GroupSet": [
                    {
                        "Ref": "HANASlaveSG"
                    }
                ],
                "SourceDestCheck": "true",
                "Tags": [
                    {
                        "Key": "Network",
                        "Value": "Private"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "6e5b6f8f-3d2b-45c2-8981-6d5d43cfe132"
                }
            }
        },
        "HANASecurityGroup": {
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": {
                "GroupDescription": "Enable external access to the HANA Master and allow communication from slave instances",
                "VpcId": {
                    "Ref": "VPCID"
                },
                "SecurityGroupIngress": [
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "10.0.1.0/24"
                        },
                        "FromPort": "1",
                        "ToPort": "65535"
                    },
                    {
                        "IpProtocol": "udp",
                        "CidrIp": {
                            "Ref": "10.0.1.0/24"
                        },
                        "FromPort": "111",
                        "ToPort": "111"
                    },
                    {
                        "IpProtocol": "udp",
                        "CidrIp": {
                            "Ref": "10.0.1.0/24"
                        },
                        "FromPort": "2049",
                        "ToPort": "2049"
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "10.0.1.0/24"
                        },
                        "FromPort": "2049",
                        "ToPort": "2049"
                    },
                    {
                        "IpProtocol": "udp",
                        "CidrIp": {
                            "Ref": "10.0.1.0/24"
                        },
                        "FromPort": "4000",
                        "ToPort": "4002"
                    },
                    {
                        "IpProtocol": "icmp",
                        "CidrIp": {
                            "Ref": "10.0.1.0/24"
                        },
                        "FromPort": "-1",
                        "ToPort": "-1"
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "10.0.2.0/24"
                        },
                        "FromPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "5",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    "13"
                                ]
                            ]
                        },
                        "ToPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "5",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    "14"
                                ]
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "10.0.2.0/24"
                        },
                        "FromPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "3",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    "13"
                                ]
                            ]
                        },
                        "ToPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "3",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    "13"
                                ]
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "10.0.2.0/24"
                        },
                        "FromPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "3",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    "15"
                                ]
                            ]
                        },
                        "ToPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "3",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    "15"
                                ]
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "10.0.2.0/24"
                        },
                        "FromPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "3",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    "17"
                                ]
                            ]
                        },
                        "ToPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "3",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    "17"
                                ]
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "10.0.2.0/24"
                        },
                        "FromPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "3",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    "41"
                                ]
                            ]
                        },
                        "ToPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "3",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    "44"
                                ]
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "10.0.2.0/24"
                        },
                        "FromPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "80",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    ""
                                ]
                            ]
                        },
                        "ToPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "80",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    ""
                                ]
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "10.0.2.0/24"
                        },
                        "FromPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "3",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    "09"
                                ]
                            ]
                        },
                        "ToPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "3",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    "09"
                                ]
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "10.0.2.0/24"
                        },
                        "FromPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "43",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    ""
                                ]
                            ]
                        },
                        "ToPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "43",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    ""
                                ]
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "10.0.2.0/24"
                        },
                        "FromPort": "8080",
                        "ToPort": "8080"
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "10.0.2.0/24"
                        },
                        "FromPort": "8443",
                        "ToPort": "8443"
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "10.0.2.0/24"
                        },
                        "FromPort": "1128",
                        "ToPort": "1128"
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "10.0.2.0/24"
                        },
                        "FromPort": "1129",
                        "ToPort": "1129"
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "10.0.2.0/24"
                        },
                        "FromPort": "22",
                        "ToPort": "22"
                    }
                ],
                "SecurityGroupEgress": [
                    {
                        "IpProtocol": "-1",
                        "CidrIp": "0.0.0.0/0",
                        "FromPort": "1",
                        "ToPort": "65535"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "42283a2f-eefe-41d0-b37a-ac62bc0399d3"
                }
            }
        },
        "HANASecurityGroupUpdate": {
            "Type": "AWS::EC2::SecurityGroupIngress",
            "Condition": "IfAppSubnet",
            "Properties": {
                "CidrIp": {
                    "Ref": "0.0.0.0/0"
                },
                "Description": "SAP Client Traffic",
                "IpProtocol": "tcp",
                "FromPort": {
                    "Fn::Join": [
                        "",
                        [
                            "3",
                            {
                                "Ref": "SAPInstanceNum"
                            },
                            "13"
                        ]
                    ]
                },
                "ToPort": {
                    "Fn::Join": [
                        "",
                        [
                            "3",
                            {
                                "Ref": "SAPInstanceNum"
                            },
                            "17"
                        ]
                    ]
                },
                "GroupId": {
                    "Ref": "HANASecurityGroup"
                }
            }
        },
        "HANASlaveSG": {
            "Type": "AWS::EC2::SecurityGroup",
            "Condition": "TwoOrMoreNodes",
            "Properties": {
                "GroupDescription": "Enable communication between the master and slave instances",
                "VpcId": {
                    "Ref": "VPCID"
                },
                "SecurityGroupIngress": [
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "1",
                        "ToPort": "65535",
                        "CidrIp": {
                            "Ref": "10.0.1.0/24"
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "5",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    "13"
                                ]
                            ]
                        },
                        "ToPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "5",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    "14"
                                ]
                            ]
                        },
                        "CidrIp": {
                            "Ref": "10.0.2.0/24"
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "3",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    "15"
                                ]
                            ]
                        },
                        "ToPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "3",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    "15"
                                ]
                            ]
                        },
                        "CidrIp": {
                            "Ref": "10.0.2.0/24"
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "3",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    "17"
                                ]
                            ]
                        },
                        "ToPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "3",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    "17"
                                ]
                            ]
                        },
                        "CidrIp": {
                            "Ref": "10.0.2.0/24"
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "1128",
                        "ToPort": "1129",
                        "CidrIp": {
                            "Ref": "10.0.2.0/24"
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "8080",
                        "ToPort": "8080",
                        "CidrIp": {
                            "Ref": "10.0.2.0/24"
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "8443",
                        "ToPort": "8443",
                        "CidrIp": {
                            "Ref": "10.0.2.0/24"
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "22",
                        "ToPort": "22",
                        "CidrIp": {
                            "Ref": "10.0.2.0/24"
                        }
                    }
                ],
                "SecurityGroupEgress": [
                    {
                        "IpProtocol": "-1",
                        "FromPort": "1",
                        "ToPort": "65535",
                        "CidrIp": "0.0.0.0/0"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "1f23d89f-a552-4e6c-b96f-7e0374c275c2"
                }
            }
        },
        "HANAIAMRole": {
            "Type": "AWS::IAM::Role",
            "Properties": {
                "AssumeRolePolicyDocument": {
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Principal": {
                                "Service": [
                                    "ec2.amazonaws.com",
                                    "ssm.amazonaws.com"
                                ]
                            },
                            "Action": [
                                "sts:AssumeRole"
                            ]
                        }
                    ]
                },
                "Path": "/",
                "ManagedPolicyArns": [
                    "arn:aws:iam::aws:policy/service-role/AmazonEC2RoleforSSM"
                ],
                "Policies": [
                    {
                        "PolicyName": "HANA-QuickStart",
                        "PolicyDocument": {
                            "Statement": [
                                {
                                    "Effect": "Allow",
                                    "Action": [
                                        "s3:GetObject",
                                        "s3:ListBucket",
                                        "s3:GetBucketLocation",
                                        "ec2:Describe*",
                                        "ec2:ModifyInstanceAttribute",
                                        "ec2:AttachVolume",
                                        "ec2:CreateTags",
                                        "ec2:CreateVolume"
                                    ],
                                    "Resource": "*"
                                },
                                {
                                    "Effect": "Allow",
                                    "Action": "cloudwatch:GetMetricStatistics",
                                    "Resource": "*"
                                },
                                {
                                    "Effect": "Allow",
                                    "Action": [
                                        "sqs:*",
                                        "dynamodb:*",
                                        "dynamodb:Scan",
                                        "dynamodb:Query",
                                        "dynamodb:GetItem",
                                        "dynamodb:BatchGetItem",
                                        "dynamodb:UpdateTable",
                                        "cloudformation:DescribeStacks",
                                        "cloudformation:DescribeStackEvents",
                                        "cloudformation:DescribeStackResource",
                                        "cloudformation:DescribeStackResources",
                                        "cloudformation:GetTemplate",
                                        "cloudformation:List*"
                                    ],
                                    "Resource": [
                                        "*"
                                    ]
                                }
                            ]
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "fd9c7ba3-4076-46e9-ad84-9092611da3c7"
                }
            }
        },
        "HANAIAMProfile": {
            "Type": "AWS::IAM::InstanceProfile",
            "Properties": {
                "Path": "/",
                "Roles": [
                    {
                        "Ref": "HANAIAMRole"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "67e54dc3-5f4e-49c0-aa1d-397e7cc0e42c"
                }
            }
        },
        "WaitForHANAInstall": {
            "Type": "AWS::CloudFormation::WaitCondition",
            "DependsOn": "HANAMasterInstance",
            "Properties": {
                "Handle": {
                    "Ref": "WaitForMasterInstallWaitHandle"
                },
                "Timeout": "7200"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "6abec30c-851d-483a-81a7-722fe286ac1a"
                }
            }
        },
        "WaitForMasterInstallWaitHandle": {
            "Type": "AWS::CloudFormation::WaitConditionHandle",
            "Properties": {},
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "176958a9-5698-47fb-8be8-8402b988d717"
                }
            }
        },
        "RDPInstanceRootRole": {
            "Condition": "NeedWindowsInstance",
            "Type": "AWS::IAM::Role",
            "Properties": {
                "AssumeRolePolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Principal": {
                                "Service": [
                                    "ec2.amazonaws.com"
                                ]
                            },
                            "Action": [
                                "sts:AssumeRole"
                            ]
                        }
                    ]
                },
                "Path": "/",
                "Policies": [
                    {
                        "PolicyName": "root",
                        "PolicyDocument": {
                            "Version": "2012-10-17",
                            "Statement": [
                                {
                                    "Effect": "Allow",
                                    "Action": [
                                        "s3:*",
                                        "ec2:Describe*",
                                        "ec2:AttachNetworkInterface",
                                        "ec2:AttachVolume",
                                        "ec2:CreateTags",
                                        "ec2:CreateVolume",
                                        "ec2:DeleteVolume",
                                        "ec2:RunInstances",
                                        "ec2:StartInstances",
                                        "ec2:CreateSecurityGroup",
                                        "ec2:CreateSnapshot"
                                    ],
                                    "Resource": "*"
                                },
                                {
                                    "Action": [
                                        "sqs:*"
                                    ],
                                    "Effect": "Allow",
                                    "Resource": "*"
                                },
                                {
                                    "Effect": "Allow",
                                    "Action": [
                                        "cloudformation:CreateStack",
                                        "cloudformation:DeleteStack",
                                        "cloudformation:DescribeStack",
                                        "cloudformation:EstimateTemplateCost",
                                        "cloudformation:ValidateTemplate",
                                        "cloudformation:DescribeStackEvents",
                                        "cloudformation:DescribeStackResource",
                                        "cloudformation:DescribeStackResources",
                                        "cloudformation:DescribeStacks"
                                    ],
                                    "Resource": [
                                        "*"
                                    ]
                                },
                                {
                                    "Effect": "Allow",
                                    "Action": [
                                        "iam:CreateRole"
                                    ],
                                    "Resource": [
                                        "*"
                                    ]
                                },
                                {
                                    "Effect": "Allow",
                                    "Action": [
                                        "iam:PutRolePolicy"
                                    ],
                                    "Resource": [
                                        "*"
                                    ]
                                },
                                {
                                    "Effect": "Allow",
                                    "Action": [
                                        "iam:CreateInstanceProfile"
                                    ],
                                    "Resource": [
                                        "*"
                                    ]
                                },
                                {
                                    "Effect": "Allow",
                                    "Action": [
                                        "iam:AddRoleToInstanceProfile"
                                    ],
                                    "Resource": [
                                        "*"
                                    ]
                                },
                                {
                                    "Effect": "Allow",
                                    "Action": [
                                        "iam:PassRole"
                                    ],
                                    "Resource": [
                                        "*"
                                    ]
                                },
                                {
                                    "Effect": "Allow",
                                    "Action": [
                                        "ec2:RevokeSecurityGroupEgress"
                                    ],
                                    "Resource": [
                                        "*"
                                    ]
                                },
                                {
                                    "Effect": "Allow",
                                    "Action": [
                                        "ec2:AuthorizeSecurityGroupEgress"
                                    ],
                                    "Resource": [
                                        "*"
                                    ]
                                },
                                {
                                    "Effect": "Allow",
                                    "Action": [
                                        "ec2:AuthorizeSecurityGroupIngress"
                                    ],
                                    "Resource": [
                                        "*"
                                    ]
                                },
                                {
                                    "Effect": "Allow",
                                    "Action": [
                                        "ec2:CreateNetworkInterface"
                                    ],
                                    "Resource": [
                                        "*"
                                    ]
                                },
                                {
                                    "Effect": "Allow",
                                    "Action": [
                                        "ec2:ModifyNetworkInterfaceAttribute"
                                    ],
                                    "Resource": [
                                        "*"
                                    ]
                                }
                            ]
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "86b0acf3-f35e-49ed-a9fe-26548b785566"
                }
            }
        },
        "RDPProfile": {
            "Condition": "NeedWindowsInstance",
            "Type": "AWS::IAM::InstanceProfile",
            "Properties": {
                "Path": "/",
                "Roles": [
                    {
                        "Ref": "RDPInstanceRootRole"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "d99f27d0-0083-4688-9470-4b1f6cf7f694"
                }
            }
        },
        "RDPSecurityGroup": {
            "Condition": "NeedWindowsInstance",
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": {
                "GroupDescription": "RDP Instance security group",
                "VpcId": {
                    "Ref": "VPCID"
                },
                "SecurityGroupIngress": [
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "3389",
                        "ToPort": "3389",
                        "CidrIp": {
                            "Ref": "0.0.0.0/0"
                        }
                    }
                ],
                "SecurityGroupEgress": [
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "1",
                        "ToPort": "65535",
                        "CidrIp": "0.0.0.0/0"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "2584d35f-b5b6-4908-9b11-00380242e421"
                }
            }
        },
        "RDPEIP": {
            "Condition": "NeedWindowsInstance",
            "Type": "AWS::EC2::EIP",
            "Properties": {
                "Domain": "vpc"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "1d374371-bb03-4f29-bc8d-336f519c4637"
                }
            }
        },
        "RDPInterface": {
            "Condition": "NeedWindowsInstance",
            "Type": "AWS::EC2::NetworkInterface",
            "Properties": {
                "SubnetId": {
                    "Ref": "DMZSubnet"
                },
                "Description": "Interface for RDP Instance",
                "GroupSet": [
                    {
                        "Ref": "RDPSecurityGroup"
                    }
                ],
                "SourceDestCheck": "true",
                "Tags": [
                    {
                        "Key": "Network",
                        "Value": "Public"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "622c357b-e28a-406a-82f9-f3122a4de661"
                }
            }
        },
        "AssociateRDPEIP": {
            "Condition": "NeedWindowsInstance",
            "Type": "AWS::EC2::EIPAssociation",
            "Properties": {
                "AllocationId": {
                    "Fn::GetAtt": [
                        "RDPEIP",
                        "AllocationId"
                    ]
                },
                "NetworkInterfaceId": {
                    "Ref": "RDPInterface"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "1b359f5f-7a21-4efc-ae7d-f347f95522be"
                }
            }
        },
        "RDPInstance": {
            "Condition": "NeedWindowsInstance",
            "Type": "AWS::EC2::Instance",
            "Properties": {
                "NetworkInterfaces": [
                    {
                        "NetworkInterfaceId": {
                            "Ref": "RDPInterface"
                        },
                        "DeviceIndex": "0"
                    }
                ],
                "KeyName": {
                    "Ref": "KeyName"
                },
                "ImageId": {
                    "Ref": "LatestWS2012AmiId"
                },
                "IamInstanceProfile": {
                    "Ref": "RDPProfile"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SAP RDP Instance (Public Subnet)"
                    }
                ],
                "InstanceType": {
                    "Ref": "RDPInstanceType"
                },
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "<powershell>\n",
                                "Set-ExecutionPolicy RemoteSigned -Force \n",
                                "Start-Process -FilePath msiexec -ArgumentList /i,  \"http://sdk-for-net.amazonwebservices.com/latest/AWSToolsAndSDKForNet.msi\", /passive -wait \n",
                                "</powershell>"
                            ]
                        ]
                    }
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "8fdfa01a-7ba4-47e6-94bf-200e2df7d03b"
                }
            }
        },
        "HANAMasterInstance": {
            "Type": "AWS::EC2::Instance",
            "Metadata": {
                "HostRole": "Master",
                "AWS::CloudFormation::Designer": {
                    "id": "bf00cdaf-6e90-4ff3-b161-f62f23f2b187"
                }
            },
            "Properties": {
                "HostId": {
                    "Fn::If": [
                        "IfDedicatedHost",
                        {
                            "Fn::Select": [
                                "0",
                                {
                                    "Ref": "DedicatedHostId"
                                }
                            ]
                        },
                        {
                            "Ref": "AWS::NoValue"
                        }
                    ]
                },
                "NetworkInterfaces": [
                    {
                        "NetworkInterfaceId": {
                            "Ref": "HANAMasterInterface"
                        },
                        "DeviceIndex": "0"
                    }
                ],
                "KeyName": {
                    "Ref": "KeyName"
                },
                "BlockDeviceMappings": [
                    {
                        "DeviceName": "/dev/sda1",
                        "Ebs": {
                            "VolumeSize": "50",
                            "VolumeType": "gp2"
                        }
                    }
                ],
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegionMap",
                        {
                            "Ref": "AWS::Region"
                        },
                        {
                            "Fn::FindInMap": [
                                "SAPAMINameMap",
                                {
                                    "Ref": "MyOS"
                                },
                                "Code"
                            ]
                        }
                    ]
                },
                "IamInstanceProfile": {
                    "Ref": "HANAIAMProfile"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SAP HANA Master"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "#!/bin/bash -xv\n",
                                "mkdir /root/install \n",
                                "hostname ",
                                {
                                    "Ref": "HANAMasterHostname"
                                },
                                "\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        ".",
                                        [
                                            {
                                                "Ref": "HANAMasterHostname"
                                            },
                                            {
                                                "Ref": "DomainName"
                                            }
                                        ]
                                    ]
                                },
                                " > /etc/HOSTNAME\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        ".",
                                        [
                                            {
                                                "Ref": "HANAMasterHostname"
                                            },
                                            {
                                                "Ref": "DomainName"
                                            }
                                        ]
                                    ]
                                },
                                " > /etc/hostname\n",
                                "export http_proxy=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "export https_proxy=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "export HTTP_PROXY=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "export HTTPS_PROXY=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "export no_proxy=localhost,127.0.0.1,169.254.169.254",
                                "\n",
                                "export NO_PROXY=localhost,127.0.0.1,169.254.169.254",
                                "\n",
                                "wget https://s3.amazonaws.com/",
                                {
                                    "Ref": "PrivateBucket"
                                },
                                "/scripts/download.sh --output-document=/root/install/download.sh\n",
                                "sh /root/install/download.sh -b ",
                                {
                                    "Ref": "PrivateBucket"
                                },
                                " -c ",
                                {
                                    "Ref": "CustomStorageConfig"
                                },
                                "\n",
                                "chmod 755 /root/install/*.sh\n",
                                "chmod 755 /root/install/*.py\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "_",
                                        [
                                            "export TABLE_NAME=HANAMonitor_",
                                            {
                                                "Ref": "AWS::StackName"
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "export TZ_INPUT_PARAM=",
                                            {
                                                "Ref": "SAPTZ"
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "export SLESBYOSRegCode=",
                                            {
                                                "Ref": "SLESBYOSRegCode"
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "export DeploymentInterruptQ=",
                                            {
                                                "Ref": "DeploymentInterruptQ"
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "export MyOS=",
                                            {
                                                "Fn::FindInMap": [
                                                    "SAPAMINameMap",
                                                    {
                                                        "Ref": "MyOS"
                                                    },
                                                    "Code"
                                                ]
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "sh /root/install/writeconfig.sh MyStackId=",
                                {
                                    "Ref": "AWS::StackId"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh INSTALL_HANA=",
                                {
                                    "Ref": "InstallHANA"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh HostCount=",
                                {
                                    "Ref": "HostCount"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh SAPInstanceNum=",
                                {
                                    "Ref": "SAPInstanceNum"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh http_proxy=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh HTTP_PROXY=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh https_proxy=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh HTTPS_PROXY=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh AWSEFS=",
                                {
                                    "Ref": "AWSEFS"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh EFSshared=",
                                {
                                    "Ref": "EFSshared"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh EFSbackup=",
                                {
                                    "Ref": "EFSbackup"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh no_proxy=localhost,127.0.0.1,169.254.169.254",
                                "\n",
                                "sh /root/install/writeconfig.sh NO_PROXY=localhost,127.0.0.1,169.254.169.254",
                                "\n",
                                "sh /root/install/writeconfig.sh IsMasterNode=1",
                                "\n",
                                "sh /root/install/writeconfig.sh IsWorkerNode=0",
                                "\n",
                                "sh /root/install/writeconfig.sh BACKUP_VOL=st1",
                                "\n",
                                "sh /root/install/writeconfig.sh SHARED_VOL=gp2",
                                "\n",
                                "sh /root/install/writeconfig.sh USR_SAP_VOL=gp2",
                                "\n",
                                "sh /root/install/writeconfig.sh HANA_MEDIA_VOL=gp2",
                                "\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "\"",
                                            "export WaitForMasterInstallWaitHandle=",
                                            "\\",
                                            "\"",
                                            {
                                                "Ref": "WaitForMasterInstallWaitHandle"
                                            },
                                            "\\",
                                            "\"",
                                            "\""
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "sh /root/install/writeconfig.sh REGION=",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "sh /root/install/install-aws.sh\n",
                                "sh /root/install/install-prereq.sh\n",
                                "#sh /root/install/signal-complete.sh \n",
                                "sh /root/install/cluster-watch-engine.sh -c \n",
                                "sh /root/install/cluster-watch-engine.sh -i ",
                                "\"",
                                "DomainName=",
                                {
                                    "Ref": "DomainName"
                                },
                                "\"",
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -i ",
                                "\"",
                                "MyHostname=",
                                {
                                    "Ref": "HANAMasterHostname"
                                },
                                "\"",
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -i ",
                                "\"",
                                "MyRole=Master",
                                "\"",
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -i ",
                                "\"",
                                "HostCount=",
                                {
                                    "Ref": "HostCount"
                                },
                                "\"",
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -i ",
                                "\"",
                                "Status=PRE_INSTALL_COMPLETE",
                                "\"",
                                "\n",
                                "sh /root/install/reconcile-ips.sh ",
                                {
                                    "Ref": "HostCount"
                                },
                                " >> /root/install.log\n",
                                "sh /root/install/fence-cluster.sh -w \"PRE_INSTALL_COMPLETE_ACK=",
                                {
                                    "Ref": "HostCount"
                                },
                                "\"",
                                "\n",
                                "sh /root/install/install-master.sh -s ",
                                {
                                    "Ref": "SID"
                                },
                                " -i ",
                                {
                                    "Ref": "SAPInstanceNum"
                                },
                                " -p '",
                                {
                                    "Ref": "HANAMasterPass"
                                },
                                "' -n ",
                                {
                                    "Ref": "HANAMasterHostname"
                                },
                                " -d ",
                                {
                                    "Ref": "DomainName"
                                },
                                " -w ",
                                {
                                    "Ref": "HANAWorkerHostname"
                                },
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -s \"MASTER_NODE_COMPLETE\"\n",
                                "sh /root/install/wait-for-workers.sh ",
                                {
                                    "Ref": "HostCount"
                                },
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh  -r \n",
                                "sh /root/install/validate-install.sh \"",
                                {
                                    "Ref": "WaitForMasterInstallWaitHandle"
                                },
                                "\" \n",
                                "#python /root/install/postprocess.py \n",
                                "sh /root/install/cleanup.sh \n",
                                "\n",
                                "\n"
                            ]
                        ]
                    }
                },
                "InstanceType": {
                    "Ref": "MyInstanceType"
                }
            }
        },
        "HANAWorkerInstance1": {
            "Type": "AWS::EC2::Instance",
            "Condition": "TwoOrMoreNodes",
            "Metadata": {
                "HostRole": "Worker",
                "AWS::CloudFormation::Designer": {
                    "id": "37c4e7fb-5cad-4d46-bd77-7302246e99c7"
                }
            },
            "Properties": {
                "HostId": {
                    "Fn::If": [
                        "IfDedicatedHost",
                        {
                            "Fn::Select": [
                                "1",
                                {
                                    "Ref": "DedicatedHostId"
                                }
                            ]
                        },
                        {
                            "Ref": "AWS::NoValue"
                        }
                    ]
                },
                "NetworkInterfaces": [
                    {
                        "NetworkInterfaceId": {
                            "Ref": "HANAWorker1Interface"
                        },
                        "DeviceIndex": "0"
                    }
                ],
                "KeyName": {
                    "Ref": "KeyName"
                },
                "BlockDeviceMappings": [
                    {
                        "DeviceName": "/dev/sda1",
                        "Ebs": {
                            "VolumeSize": "50",
                            "VolumeType": "gp2"
                        }
                    }
                ],
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegionMap",
                        {
                            "Ref": "AWS::Region"
                        },
                        {
                            "Fn::FindInMap": [
                                "SAPAMINameMap",
                                {
                                    "Ref": "MyOS"
                                },
                                "Code"
                            ]
                        }
                    ]
                },
                "IamInstanceProfile": {
                    "Ref": "HANAIAMProfile"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SAP HANA Worker 1"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "#!/bin/bash -xv\n",
                                "mkdir /root/install \n",
                                "hostname ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Ref": "HANAWorkerHostname"
                                            },
                                            "01"
                                        ]
                                    ]
                                },
                                "\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Ref": "HANAWorkerHostname"
                                            },
                                            "01",
                                            ".",
                                            {
                                                "Ref": "DomainName"
                                            }
                                        ]
                                    ]
                                },
                                " > /etc/HOSTNAME\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Ref": "HANAWorkerHostname"
                                            },
                                            "01",
                                            ".",
                                            {
                                                "Ref": "DomainName"
                                            }
                                        ]
                                    ]
                                },
                                " > /etc/hostname\n",
                                "export http_proxy=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "export https_proxy=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "export HTTP_PROXY=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "export HTTPS_PROXY=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh AWSEFS=",
                                {
                                    "Ref": "AWSEFS"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh EFSshared=",
                                {
                                    "Ref": "EFSshared"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh EFSbackup=",
                                {
                                    "Ref": "EFSbackup"
                                },
                                "\n",
                                "export no_proxy=localhost,127.0.0.1,169.254.169.254",
                                "\n",
                                "export NO_PROXY=localhost,127.0.0.1,169.254.169.254",
                                "\n",
                                "wget https://s3.amazonaws.com/",
                                {
                                    "Ref": "PrivateBucket"
                                },
                                "/scripts/download.sh --output-document=/root/install/download.sh\n",
                                "sh /root/install/download.sh -b ",
                                {
                                    "Ref": "PrivateBucket"
                                },
                                " -c ",
                                {
                                    "Ref": "CustomStorageConfig"
                                },
                                "\n",
                                "chmod 755 /root/install/*.sh\n",
                                "chmod 755 /root/install/*.py\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "_",
                                        [
                                            "export TABLE_NAME=HANAMonitor_",
                                            {
                                                "Ref": "AWS::StackName"
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "export TZ_INPUT_PARAM=",
                                            {
                                                "Ref": "SAPTZ"
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "export SLESBYOSRegCode=",
                                            {
                                                "Ref": "SLESBYOSRegCode"
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "export DeploymentInterruptQ=",
                                            {
                                                "Ref": "DeploymentInterruptQ"
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "export MyOS=",
                                            {
                                                "Fn::FindInMap": [
                                                    "SAPAMINameMap",
                                                    {
                                                        "Ref": "MyOS"
                                                    },
                                                    "Code"
                                                ]
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "sh /root/install/writeconfig.sh MyStackId=",
                                {
                                    "Ref": "AWS::StackId"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh INSTALL_HANA=",
                                {
                                    "Ref": "InstallHANA"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh HostCount=",
                                {
                                    "Ref": "HostCount"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh http_proxy=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh HTTP_PROXY=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh https_proxy=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh HTTPS_PROXY=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh AWSEFS=",
                                {
                                    "Ref": "AWSEFS"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh EFSshared=",
                                {
                                    "Ref": "EFSshared"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh EFSbackup=",
                                {
                                    "Ref": "EFSbackup"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh no_proxy=localhost,127.0.0.1,169.254.169.254",
                                "\n",
                                "sh /root/install/writeconfig.sh NO_PROXY=localhost,127.0.0.1,169.254.169.254",
                                "\n",
                                "sh /root/install/writeconfig.sh IsMasterNode=0",
                                "\n",
                                "sh /root/install/writeconfig.sh IsWorkerNode=1",
                                "\n",
                                "sh /root/install/writeconfig.sh USR_SAP_VOL=gp2",
                                "\n",
                                "sh /root/install/writeconfig.sh REGION=",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "sh /root/install/install-aws.sh\n",
                                "sh /root/install/install-prereq.sh\n",
                                "sh /root/install/cluster-watch-engine.sh -c \n",
                                "sh /root/install/cluster-watch-engine.sh -i ",
                                "\"",
                                "DomainName=",
                                {
                                    "Ref": "DomainName"
                                },
                                "\"",
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -i ",
                                "\"",
                                "MyHostname=",
                                {
                                    "Ref": "HANAWorkerHostname"
                                },
                                "01",
                                "\"",
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -i ",
                                "\"",
                                "MyRole=Worker",
                                "\"",
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -i ",
                                "\"",
                                "HostCount=",
                                {
                                    "Ref": "HostCount"
                                },
                                "\"",
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -s \"PRE_INSTALL_COMPLETE\"\n",
                                "sh /root/install/reconcile-ips.sh ",
                                {
                                    "Ref": "HostCount"
                                },
                                "\n",
                                "sh /root/install/fence-cluster.sh -w \"PRE_INSTALL_COMPLETE_ACK=",
                                {
                                    "Ref": "HostCount"
                                },
                                "\"",
                                "\n",
                                "sh /root/install/wait-for-master.sh\n",
                                "sh /root/install/install-worker.sh -s ",
                                {
                                    "Ref": "SID"
                                },
                                " -p '",
                                {
                                    "Ref": "HANAMasterPass"
                                },
                                "' -n ",
                                {
                                    "Ref": "HANAMasterHostname"
                                },
                                " -d ",
                                {
                                    "Ref": "DomainName"
                                },
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -s \"WORKER_NODE_COMPLETE\"\n",
                                "sh /root/install/wait-for-workers.sh ",
                                {
                                    "Ref": "HostCount"
                                },
                                "\n",
                                "#python /root/install/postprocess.py \n",
                                "sh /root/install/cleanup.sh ",
                                "\n",
                                "' ",
                                "\n"
                            ]
                        ]
                    }
                },
                "InstanceType": {
                    "Ref": "MyInstanceType"
                }
            }
        },
        "HANAWorkerInstance2": {
            "Type": "AWS::EC2::Instance",
            "Condition": "ThreeOrMoreNodes",
            "Metadata": {
                "HostRole": "Worker",
                "AWS::CloudFormation::Designer": {
                    "id": "3dc685df-0fba-446f-b2e9-634d8ad37e1c"
                }
            },
            "Properties": {
                "HostId": {
                    "Fn::If": [
                        "IfDedicatedHost",
                        {
                            "Fn::Select": [
                                "2",
                                {
                                    "Ref": "DedicatedHostId"
                                }
                            ]
                        },
                        {
                            "Ref": "AWS::NoValue"
                        }
                    ]
                },
                "NetworkInterfaces": [
                    {
                        "NetworkInterfaceId": {
                            "Ref": "HANAWorker2Interface"
                        },
                        "DeviceIndex": "0"
                    }
                ],
                "KeyName": {
                    "Ref": "KeyName"
                },
                "BlockDeviceMappings": [
                    {
                        "DeviceName": "/dev/sda1",
                        "Ebs": {
                            "VolumeSize": "50",
                            "VolumeType": "gp2"
                        }
                    }
                ],
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegionMap",
                        {
                            "Ref": "AWS::Region"
                        },
                        {
                            "Fn::FindInMap": [
                                "SAPAMINameMap",
                                {
                                    "Ref": "MyOS"
                                },
                                "Code"
                            ]
                        }
                    ]
                },
                "IamInstanceProfile": {
                    "Ref": "HANAIAMProfile"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SAP HANA Worker 2"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "#!/bin/bash -xv\n",
                                "mkdir /root/install \n",
                                "hostname ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Ref": "HANAWorkerHostname"
                                            },
                                            "02"
                                        ]
                                    ]
                                },
                                "\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Ref": "HANAWorkerHostname"
                                            },
                                            "02",
                                            ".",
                                            {
                                                "Ref": "DomainName"
                                            }
                                        ]
                                    ]
                                },
                                " > /etc/HOSTNAME\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Ref": "HANAWorkerHostname"
                                            },
                                            "02",
                                            ".",
                                            {
                                                "Ref": "DomainName"
                                            }
                                        ]
                                    ]
                                },
                                " > /etc/hostname\n",
                                "export http_proxy=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "export https_proxy=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "export HTTP_PROXY=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "export HTTPS_PROXY=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "export no_proxy=localhost,127.0.0.1,169.254.169.254",
                                "\n",
                                "export NO_PROXY=localhost,127.0.0.1,169.254.169.254",
                                "\n",
                                "wget https://s3.amazonaws.com/",
                                {
                                    "Ref": "PrivateBucket"
                                },
                                "/scripts/download.sh --output-document=/root/install/download.sh\n",
                                "sh /root/install/download.sh -b ",
                                {
                                    "Ref": "PrivateBucket"
                                },
                                " -c ",
                                {
                                    "Ref": "CustomStorageConfig"
                                },
                                "\n",
                                "chmod 755 /root/install/*.sh\n",
                                "chmod 755 /root/install/*.py\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "_",
                                        [
                                            "export TABLE_NAME=HANAMonitor_",
                                            {
                                                "Ref": "AWS::StackName"
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "export TZ_INPUT_PARAM=",
                                            {
                                                "Ref": "SAPTZ"
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "export SLESBYOSRegCode=",
                                            {
                                                "Ref": "SLESBYOSRegCode"
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "export DeploymentInterruptQ=",
                                            {
                                                "Ref": "DeploymentInterruptQ"
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "export MyOS=",
                                            {
                                                "Fn::FindInMap": [
                                                    "SAPAMINameMap",
                                                    {
                                                        "Ref": "MyOS"
                                                    },
                                                    "Code"
                                                ]
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "sh /root/install/writeconfig.sh MyStackId=",
                                {
                                    "Ref": "AWS::StackId"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh INSTALL_HANA=",
                                {
                                    "Ref": "InstallHANA"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh HostCount=",
                                {
                                    "Ref": "HostCount"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh http_proxy=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh HTTP_PROXY=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh https_proxy=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh HTTPS_PROXY=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh AWSEFS=",
                                {
                                    "Ref": "AWSEFS"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh EFSshared=",
                                {
                                    "Ref": "EFSshared"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh EFSbackup=",
                                {
                                    "Ref": "EFSbackup"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh no_proxy=localhost,127.0.0.1,169.254.169.254",
                                "\n",
                                "sh /root/install/writeconfig.sh NO_PROXY=localhost,127.0.0.1,169.254.169.254",
                                "\n",
                                "sh /root/install/writeconfig.sh IsMasterNode=0",
                                "\n",
                                "sh /root/install/writeconfig.sh IsWorkerNode=1",
                                "\n",
                                "sh /root/install/writeconfig.sh USR_SAP_VOL=gp2",
                                "\n",
                                "sh /root/install/writeconfig.sh REGION=",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "sh /root/install/install-aws.sh\n",
                                "sh /root/install/install-prereq.sh\n",
                                "sh /root/install/cluster-watch-engine.sh -c \n",
                                "sh /root/install/cluster-watch-engine.sh -i ",
                                "\"",
                                "DomainName=",
                                {
                                    "Ref": "DomainName"
                                },
                                "\"",
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -i ",
                                "\"",
                                "MyHostname=",
                                {
                                    "Ref": "HANAWorkerHostname"
                                },
                                "02",
                                "\"",
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -i ",
                                "\"",
                                "MyRole=Worker",
                                "\"",
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -i ",
                                "\"",
                                "HostCount=",
                                {
                                    "Ref": "HostCount"
                                },
                                "\"",
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -s \"PRE_INSTALL_COMPLETE\"\n",
                                "sh /root/install/reconcile-ips.sh ",
                                {
                                    "Ref": "HostCount"
                                },
                                "\n",
                                "sh /root/install/fence-cluster.sh -w \"PRE_INSTALL_COMPLETE_ACK=",
                                {
                                    "Ref": "HostCount"
                                },
                                "\"",
                                "\n",
                                "sh /root/install/wait-for-master.sh\n",
                                "sh /root/install/install-worker.sh -s ",
                                {
                                    "Ref": "SID"
                                },
                                " -p '",
                                {
                                    "Ref": "HANAMasterPass"
                                },
                                "' -n ",
                                {
                                    "Ref": "HANAMasterHostname"
                                },
                                " -d ",
                                {
                                    "Ref": "DomainName"
                                },
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -s \"WORKER_NODE_COMPLETE\"\n",
                                "sh /root/install/wait-for-workers.sh ",
                                {
                                    "Ref": "HostCount"
                                },
                                "\n",
                                "#python /root/install/postprocess.py \n",
                                "sh /root/install/cleanup.sh ",
                                "\n",
                                "' ",
                                "\n"
                            ]
                        ]
                    }
                },
                "InstanceType": {
                    "Ref": "MyInstanceType"
                }
            }
        },
        "HANAWorkerInstance3": {
            "Type": "AWS::EC2::Instance",
            "Condition": "FourOrMoreNodes",
            "Metadata": {
                "HostRole": "Worker",
                "AWS::CloudFormation::Designer": {
                    "id": "713627a4-eec6-4a97-81dc-4c3c625784e9"
                }
            },
            "Properties": {
                "HostId": {
                    "Fn::If": [
                        "IfDedicatedHost",
                        {
                            "Fn::Select": [
                                "3",
                                {
                                    "Ref": "DedicatedHostId"
                                }
                            ]
                        },
                        {
                            "Ref": "AWS::NoValue"
                        }
                    ]
                },
                "NetworkInterfaces": [
                    {
                        "NetworkInterfaceId": {
                            "Ref": "HANAWorker3Interface"
                        },
                        "DeviceIndex": "0"
                    }
                ],
                "KeyName": {
                    "Ref": "KeyName"
                },
                "BlockDeviceMappings": [
                    {
                        "DeviceName": "/dev/sda1",
                        "Ebs": {
                            "VolumeSize": "50",
                            "VolumeType": "gp2"
                        }
                    }
                ],
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegionMap",
                        {
                            "Ref": "AWS::Region"
                        },
                        {
                            "Fn::FindInMap": [
                                "SAPAMINameMap",
                                {
                                    "Ref": "MyOS"
                                },
                                "Code"
                            ]
                        }
                    ]
                },
                "IamInstanceProfile": {
                    "Ref": "HANAIAMProfile"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SAP HANA Worker 3"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "#!/bin/bash -xv\n",
                                "mkdir /root/install \n",
                                "hostname ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Ref": "HANAWorkerHostname"
                                            },
                                            "03"
                                        ]
                                    ]
                                },
                                "\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Ref": "HANAWorkerHostname"
                                            },
                                            "03",
                                            ".",
                                            {
                                                "Ref": "DomainName"
                                            }
                                        ]
                                    ]
                                },
                                " > /etc/HOSTNAME\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Ref": "HANAWorkerHostname"
                                            },
                                            "03",
                                            ".",
                                            {
                                                "Ref": "DomainName"
                                            }
                                        ]
                                    ]
                                },
                                " > /etc/hostname\n",
                                "export http_proxy=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "export https_proxy=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "export HTTP_PROXY=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "export HTTPS_PROXY=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh AWSEFS=",
                                {
                                    "Ref": "AWSEFS"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh EFSshared=",
                                {
                                    "Ref": "EFSshared"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh EFSbackup=",
                                {
                                    "Ref": "EFSbackup"
                                },
                                "\n",
                                "export no_proxy=localhost,127.0.0.1,169.254.169.254",
                                "\n",
                                "export NO_PROXY=localhost,127.0.0.1,169.254.169.254",
                                "\n",
                                "wget https://s3.amazonaws.com/",
                                {
                                    "Ref": "PrivateBucket"
                                },
                                "/scripts/download.sh --output-document=/root/install/download.sh\n",
                                "sh /root/install/download.sh -b ",
                                {
                                    "Ref": "PrivateBucket"
                                },
                                " -c ",
                                {
                                    "Ref": "CustomStorageConfig"
                                },
                                "\n",
                                "chmod 755 /root/install/*.sh\n",
                                "chmod 755 /root/install/*.py\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "_",
                                        [
                                            "export TABLE_NAME=HANAMonitor_",
                                            {
                                                "Ref": "AWS::StackName"
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "export TZ_INPUT_PARAM=",
                                            {
                                                "Ref": "SAPTZ"
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "export SLESBYOSRegCode=",
                                            {
                                                "Ref": "SLESBYOSRegCode"
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "export DeploymentInterruptQ=",
                                            {
                                                "Ref": "DeploymentInterruptQ"
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "export MyOS=",
                                            {
                                                "Fn::FindInMap": [
                                                    "SAPAMINameMap",
                                                    {
                                                        "Ref": "MyOS"
                                                    },
                                                    "Code"
                                                ]
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "sh /root/install/writeconfig.sh MyStackId=",
                                {
                                    "Ref": "AWS::StackId"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh INSTALL_HANA=",
                                {
                                    "Ref": "InstallHANA"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh HostCount=",
                                {
                                    "Ref": "HostCount"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh http_proxy=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh HTTP_PROXY=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh https_proxy=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh HTTPS_PROXY=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh AWSEFS=",
                                {
                                    "Ref": "AWSEFS"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh EFSshared=",
                                {
                                    "Ref": "EFSshared"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh EFSbackup=",
                                {
                                    "Ref": "EFSbackup"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh no_proxy=localhost,127.0.0.1,169.254.169.254",
                                "\n",
                                "sh /root/install/writeconfig.sh NO_PROXY=localhost,127.0.0.1,169.254.169.254",
                                "\n",
                                "sh /root/install/writeconfig.sh IsMasterNode=0",
                                "\n",
                                "sh /root/install/writeconfig.sh IsWorkerNode=1",
                                "\n",
                                "sh /root/install/writeconfig.sh USR_SAP_VOL=gp2",
                                "\n",
                                "sh /root/install/writeconfig.sh REGION=",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "sh /root/install/install-aws.sh\n",
                                "sh /root/install/install-prereq.sh\n",
                                "sh /root/install/cluster-watch-engine.sh -c \n",
                                "sh /root/install/cluster-watch-engine.sh -i ",
                                "\"",
                                "DomainName=",
                                {
                                    "Ref": "DomainName"
                                },
                                "\"",
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -i ",
                                "\"",
                                "MyHostname=",
                                {
                                    "Ref": "HANAWorkerHostname"
                                },
                                "03",
                                "\"",
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -i ",
                                "\"",
                                "MyRole=Worker",
                                "\"",
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -i ",
                                "\"",
                                "HostCount=",
                                {
                                    "Ref": "HostCount"
                                },
                                "\"",
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -s \"PRE_INSTALL_COMPLETE\"\n",
                                "sh /root/install/reconcile-ips.sh ",
                                {
                                    "Ref": "HostCount"
                                },
                                "\n",
                                "sh /root/install/fence-cluster.sh -w \"PRE_INSTALL_COMPLETE_ACK=",
                                {
                                    "Ref": "HostCount"
                                },
                                "\"",
                                "\n",
                                "sh /root/install/wait-for-master.sh\n",
                                "sh /root/install/install-worker.sh -s ",
                                {
                                    "Ref": "SID"
                                },
                                " -p '",
                                {
                                    "Ref": "HANAMasterPass"
                                },
                                "' -n ",
                                {
                                    "Ref": "HANAMasterHostname"
                                },
                                " -d ",
                                {
                                    "Ref": "DomainName"
                                },
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -s \"WORKER_NODE_COMPLETE\"\n",
                                "sh /root/install/wait-for-workers.sh ",
                                {
                                    "Ref": "HostCount"
                                },
                                "\n",
                                "#python /root/install/postprocess.py \n",
                                "sh /root/install/cleanup.sh ",
                                "\n",
                                "' ",
                                "\n"
                            ]
                        ]
                    }
                },
                "InstanceType": {
                    "Ref": "MyInstanceType"
                }
            }
        },
        "HANAWorkerInstance4": {
            "Type": "AWS::EC2::Instance",
            "Condition": "FiveOrMoreNodes",
            "Metadata": {
                "HostRole": "Worker",
                "AWS::CloudFormation::Designer": {
                    "id": "4c6fedb8-6800-449a-9839-937ec36b7d04"
                }
            },
            "Properties": {
                "HostId": {
                    "Fn::If": [
                        "IfDedicatedHost",
                        {
                            "Fn::Select": [
                                "4",
                                {
                                    "Ref": "DedicatedHostId"
                                }
                            ]
                        },
                        {
                            "Ref": "AWS::NoValue"
                        }
                    ]
                },
                "NetworkInterfaces": [
                    {
                        "NetworkInterfaceId": {
                            "Ref": "HANAWorker4Interface"
                        },
                        "DeviceIndex": "0"
                    }
                ],
                "KeyName": {
                    "Ref": "KeyName"
                },
                "BlockDeviceMappings": [
                    {
                        "DeviceName": "/dev/sda1",
                        "Ebs": {
                            "VolumeSize": "50",
                            "VolumeType": "gp2"
                        }
                    }
                ],
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegionMap",
                        {
                            "Ref": "AWS::Region"
                        },
                        {
                            "Fn::FindInMap": [
                                "SAPAMINameMap",
                                {
                                    "Ref": "MyOS"
                                },
                                "Code"
                            ]
                        }
                    ]
                },
                "IamInstanceProfile": {
                    "Ref": "HANAIAMProfile"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SAP HANA Worker 4"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "#!/bin/bash -xv\n",
                                "mkdir /root/install \n",
                                "hostname ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Ref": "HANAWorkerHostname"
                                            },
                                            "04"
                                        ]
                                    ]
                                },
                                "\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Ref": "HANAWorkerHostname"
                                            },
                                            "04",
                                            ".",
                                            {
                                                "Ref": "DomainName"
                                            }
                                        ]
                                    ]
                                },
                                " > /etc/HOSTNAME\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Ref": "HANAWorkerHostname"
                                            },
                                            "04",
                                            ".",
                                            {
                                                "Ref": "DomainName"
                                            }
                                        ]
                                    ]
                                },
                                " > /etc/hostname\n",
                                "export http_proxy=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "export https_proxy=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "export HTTP_PROXY=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "export HTTPS_PROXY=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh AWSEFS=",
                                {
                                    "Ref": "AWSEFS"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh EFSshared=",
                                {
                                    "Ref": "EFSshared"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh EFSbackup=",
                                {
                                    "Ref": "EFSbackup"
                                },
                                "\n",
                                "export no_proxy=localhost,127.0.0.1,169.254.169.254",
                                "\n",
                                "export NO_PROXY=localhost,127.0.0.1,169.254.169.254",
                                "\n",
                                "wget https://s3.amazonaws.com/",
                                {
                                    "Ref": "PrivateBucket"
                                },
                                "/scripts/download.sh --output-document=/root/install/download.sh\n",
                                "sh /root/install/download.sh -b ",
                                {
                                    "Ref": "PrivateBucket"
                                },
                                " -c ",
                                {
                                    "Ref": "CustomStorageConfig"
                                },
                                "\n",
                                "chmod 755 /root/install/*.sh\n",
                                "chmod 755 /root/install/*.py\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "_",
                                        [
                                            "export TABLE_NAME=HANAMonitor_",
                                            {
                                                "Ref": "AWS::StackName"
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "export TZ_INPUT_PARAM=",
                                            {
                                                "Ref": "SAPTZ"
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "export SLESBYOSRegCode=",
                                            {
                                                "Ref": "SLESBYOSRegCode"
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "export DeploymentInterruptQ=",
                                            {
                                                "Ref": "DeploymentInterruptQ"
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "export MyOS=",
                                            {
                                                "Fn::FindInMap": [
                                                    "SAPAMINameMap",
                                                    {
                                                        "Ref": "MyOS"
                                                    },
                                                    "Code"
                                                ]
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "sh /root/install/writeconfig.sh MyStackId=",
                                {
                                    "Ref": "AWS::StackId"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh INSTALL_HANA=",
                                {
                                    "Ref": "InstallHANA"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh HostCount=",
                                {
                                    "Ref": "HostCount"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh http_proxy=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh HTTP_PROXY=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh https_proxy=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh HTTPS_PROXY=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh AWSEFS=",
                                {
                                    "Ref": "AWSEFS"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh EFSshared=",
                                {
                                    "Ref": "EFSshared"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh EFSbackup=",
                                {
                                    "Ref": "EFSbackup"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh no_proxy=localhost,127.0.0.1,169.254.169.254",
                                "\n",
                                "sh /root/install/writeconfig.sh NO_PROXY=localhost,127.0.0.1,169.254.169.254",
                                "\n",
                                "sh /root/install/writeconfig.sh IsMasterNode=0",
                                "\n",
                                "sh /root/install/writeconfig.sh IsWorkerNode=1",
                                "\n",
                                "sh /root/install/writeconfig.sh USR_SAP_VOL=gp2",
                                "\n",
                                "sh /root/install/writeconfig.sh REGION=",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "sh /root/install/install-aws.sh\n",
                                "sh /root/install/install-prereq.sh\n",
                                "sh /root/install/cluster-watch-engine.sh -c \n",
                                "sh /root/install/cluster-watch-engine.sh -i ",
                                "\"",
                                "DomainName=",
                                {
                                    "Ref": "DomainName"
                                },
                                "\"",
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -i ",
                                "\"",
                                "MyHostname=",
                                {
                                    "Ref": "HANAWorkerHostname"
                                },
                                "04",
                                "\"",
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -i ",
                                "\"",
                                "MyRole=Worker",
                                "\"",
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -i ",
                                "\"",
                                "HostCount=",
                                {
                                    "Ref": "HostCount"
                                },
                                "\"",
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -s \"PRE_INSTALL_COMPLETE\"\n",
                                "sh /root/install/reconcile-ips.sh ",
                                {
                                    "Ref": "HostCount"
                                },
                                "\n",
                                "sh /root/install/fence-cluster.sh -w \"PRE_INSTALL_COMPLETE_ACK=",
                                {
                                    "Ref": "HostCount"
                                },
                                "\"",
                                "\n",
                                "sh /root/install/wait-for-master.sh\n",
                                "sh /root/install/install-worker.sh -s ",
                                {
                                    "Ref": "SID"
                                },
                                " -p '",
                                {
                                    "Ref": "HANAMasterPass"
                                },
                                "' -n ",
                                {
                                    "Ref": "HANAMasterHostname"
                                },
                                " -d ",
                                {
                                    "Ref": "DomainName"
                                },
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -s \"WORKER_NODE_COMPLETE\"\n",
                                "sh /root/install/wait-for-workers.sh ",
                                {
                                    "Ref": "HostCount"
                                },
                                "\n",
                                "#python /root/install/postprocess.py \n",
                                "sh /root/install/cleanup.sh ",
                                "\n",
                                "' ",
                                "\n"
                            ]
                        ]
                    }
                },
                "InstanceType": {
                    "Ref": "MyInstanceType"
                }
            }
        },
        "HANAWorkerInstance5": {
            "Type": "AWS::EC2::Instance",
            "Condition": "SixOrMoreNodes",
            "Metadata": {
                "HostRole": "Worker",
                "AWS::CloudFormation::Designer": {
                    "id": "6cfb46b6-f53f-40e1-8d63-de10912b7721"
                }
            },
            "Properties": {
                "HostId": {
                    "Fn::If": [
                        "IfDedicatedHost",
                        {
                            "Fn::Select": [
                                "5",
                                {
                                    "Ref": "DedicatedHostId"
                                }
                            ]
                        },
                        {
                            "Ref": "AWS::NoValue"
                        }
                    ]
                },
                "NetworkInterfaces": [
                    {
                        "NetworkInterfaceId": {
                            "Ref": "HANAWorker5Interface"
                        },
                        "DeviceIndex": "0"
                    }
                ],
                "KeyName": {
                    "Ref": "KeyName"
                },
                "BlockDeviceMappings": [
                    {
                        "DeviceName": "/dev/sda1",
                        "Ebs": {
                            "VolumeSize": "50",
                            "VolumeType": "gp2"
                        }
                    }
                ],
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegionMap",
                        {
                            "Ref": "AWS::Region"
                        },
                        {
                            "Fn::FindInMap": [
                                "SAPAMINameMap",
                                {
                                    "Ref": "MyOS"
                                },
                                "Code"
                            ]
                        }
                    ]
                },
                "IamInstanceProfile": {
                    "Ref": "HANAIAMProfile"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SAP HANA Worker 5"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "#!/bin/bash -xv\n",
                                "mkdir /root/install \n",
                                "hostname ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Ref": "HANAWorkerHostname"
                                            },
                                            "05"
                                        ]
                                    ]
                                },
                                "\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Ref": "HANAWorkerHostname"
                                            },
                                            "05",
                                            ".",
                                            {
                                                "Ref": "DomainName"
                                            }
                                        ]
                                    ]
                                },
                                " > /etc/HOSTNAME\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Ref": "HANAWorkerHostname"
                                            },
                                            "05",
                                            ".",
                                            {
                                                "Ref": "DomainName"
                                            }
                                        ]
                                    ]
                                },
                                " > /etc/hostname\n",
                                "export http_proxy=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "export https_proxy=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "export HTTP_PROXY=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "export HTTPS_PROXY=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "export no_proxy=localhost,127.0.0.1,169.254.169.254",
                                "\n",
                                "export NO_PROXY=localhost,127.0.0.1,169.254.169.254",
                                "\n",
                                "wget https://s3.amazonaws.com/",
                                {
                                    "Ref": "PrivateBucket"
                                },
                                "/scripts/download.sh --output-document=/root/install/download.sh\n",
                                "sh /root/install/download.sh -b ",
                                {
                                    "Ref": "PrivateBucket"
                                },
                                " -c ",
                                {
                                    "Ref": "CustomStorageConfig"
                                },
                                "\n",
                                "chmod 755 /root/install/*.sh\n",
                                "chmod 755 /root/install/*.py\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "_",
                                        [
                                            "export TABLE_NAME=HANAMonitor_",
                                            {
                                                "Ref": "AWS::StackName"
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "export TZ_INPUT_PARAM=",
                                            {
                                                "Ref": "SAPTZ"
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "export SLESBYOSRegCode=",
                                            {
                                                "Ref": "SLESBYOSRegCode"
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "export DeploymentInterruptQ=",
                                            {
                                                "Ref": "DeploymentInterruptQ"
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "export MyOS=",
                                            {
                                                "Fn::FindInMap": [
                                                    "SAPAMINameMap",
                                                    {
                                                        "Ref": "MyOS"
                                                    },
                                                    "Code"
                                                ]
                                            }
                                        ]
                                    ]
                                },
                                " >> /root/install/config.sh\n",
                                "sh /root/install/writeconfig.sh MyStackId=",
                                {
                                    "Ref": "AWS::StackId"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh INSTALL_HANA=",
                                {
                                    "Ref": "InstallHANA"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh HostCount=",
                                {
                                    "Ref": "HostCount"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh http_proxy=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh HTTP_PROXY=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh https_proxy=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh HTTPS_PROXY=",
                                {
                                    "Ref": "Proxy"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh AWSEFS=",
                                {
                                    "Ref": "AWSEFS"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh EFSshared=",
                                {
                                    "Ref": "EFSshared"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh EFSbackup=",
                                {
                                    "Ref": "EFSbackup"
                                },
                                "\n",
                                "sh /root/install/writeconfig.sh no_proxy=localhost,127.0.0.1,169.254.169.254",
                                "\n",
                                "sh /root/install/writeconfig.sh NO_PROXY=localhost,127.0.0.1,169.254.169.254",
                                "\n",
                                "sh /root/install/writeconfig.sh IsMasterNode=0",
                                "\n",
                                "sh /root/install/writeconfig.sh IsWorkerNode=1",
                                "\n",
                                "sh /root/install/writeconfig.sh USR_SAP_VOL=gp2",
                                "\n",
                                "sh /root/install/writeconfig.sh REGION=",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "sh /root/install/install-aws.sh\n",
                                "sh /root/install/install-prereq.sh\n",
                                "sh /root/install/cluster-watch-engine.sh -c \n",
                                "sh /root/install/cluster-watch-engine.sh -i ",
                                "\"",
                                "DomainName=",
                                {
                                    "Ref": "DomainName"
                                },
                                "\"",
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -i ",
                                "\"",
                                "MyHostname=",
                                {
                                    "Ref": "HANAWorkerHostname"
                                },
                                "05",
                                "\"",
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -i ",
                                "\"",
                                "MyRole=Worker",
                                "\"",
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -i ",
                                "\"",
                                "HostCount=",
                                {
                                    "Ref": "HostCount"
                                },
                                "\"",
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -s \"PRE_INSTALL_COMPLETE\"\n",
                                "sh /root/install/reconcile-ips.sh ",
                                {
                                    "Ref": "HostCount"
                                },
                                "\n",
                                "sh /root/install/fence-cluster.sh -w \"PRE_INSTALL_COMPLETE_ACK=",
                                {
                                    "Ref": "HostCount"
                                },
                                "\"",
                                "\n",
                                "sh /root/install/wait-for-master.sh\n",
                                "sh /root/install/install-worker.sh -s ",
                                {
                                    "Ref": "SID"
                                },
                                " -p '",
                                {
                                    "Ref": "HANAMasterPass"
                                },
                                "' -n ",
                                {
                                    "Ref": "HANAMasterHostname"
                                },
                                " -d ",
                                {
                                    "Ref": "DomainName"
                                },
                                "\n",
                                "sh /root/install/cluster-watch-engine.sh -s \"WORKER_NODE_COMPLETE\"\n",
                                "sh /root/install/wait-for-workers.sh ",
                                {
                                    "Ref": "HostCount"
                                },
                                "\n",
                                "#python /root/install/postprocess.py \n",
                                "sh /root/install/cleanup.sh ",
                                "\n",
                                "' ",
                                "\n"
                            ]
                        ]
                    }
                },
                "InstanceType": {
                    "Ref": "MyInstanceType"
                }
            }
        },
        "AutoRecoverAlarmMaster": {
            "Type": "AWS::CloudWatch::Alarm",
            "Condition": "AutoRecoveryMaster",
            "Properties": {
                "AlarmDescription": "Trigger a recovery when instance status check fails for 5 consecutive minute.",
                "Namespace": "AWS/EC2",
                "MetricName": "StatusCheckFailed_System",
                "Statistic": "Minimum",
                "Period": "60",
                "EvaluationPeriods": "5",
                "ComparisonOperator": "GreaterThanThreshold",
                "Threshold": "0",
                "AlarmActions": [
                    {
                        "Fn::Join": [
                            "",
                            [
                                "arn:aws:automate:",
                                {
                                    "Ref": "AWS::Region"
                                },
                                ":ec2:recover"
                            ]
                        ]
                    }
                ],
                "Dimensions": [
                    {
                        "Name": "InstanceId",
                        "Value": {
                            "Ref": "HANAMasterInstance"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "72e4c90a-49fc-49b7-8b12-25d2ff717a19"
                }
            }
        },
        "AutoRecoverAlarmWorker1": {
            "Type": "AWS::CloudWatch::Alarm",
            "Condition": "AutoRecoveryWorker1",
            "Properties": {
                "AlarmDescription": "Trigger a recovery when instance status check fails for 5 consecutive minutes.",
                "Namespace": "AWS/EC2",
                "MetricName": "StatusCheckFailed_System",
                "Statistic": "Minimum",
                "Period": "60",
                "EvaluationPeriods": "5",
                "ComparisonOperator": "GreaterThanThreshold",
                "Threshold": "0",
                "AlarmActions": [
                    {
                        "Fn::Join": [
                            "",
                            [
                                "arn:aws:automate:",
                                {
                                    "Ref": "AWS::Region"
                                },
                                ":ec2:recover"
                            ]
                        ]
                    }
                ],
                "Dimensions": [
                    {
                        "Name": "InstanceId",
                        "Value": {
                            "Ref": "HANAWorkerInstance1"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "7b1a2e66-4d5d-406a-9200-ffb65eb0cf6c"
                }
            }
        },
        "AutoRecoverAlarmWorker2": {
            "Type": "AWS::CloudWatch::Alarm",
            "Condition": "AutoRecoveryWorker2",
            "Properties": {
                "AlarmDescription": "Trigger a recovery when instance status check fails for 5 consecutive minutes.",
                "Namespace": "AWS/EC2",
                "MetricName": "StatusCheckFailed_System",
                "Statistic": "Minimum",
                "Period": "60",
                "EvaluationPeriods": "5",
                "ComparisonOperator": "GreaterThanThreshold",
                "Threshold": "0",
                "AlarmActions": [
                    {
                        "Fn::Join": [
                            "",
                            [
                                "arn:aws:automate:",
                                {
                                    "Ref": "AWS::Region"
                                },
                                ":ec2:recover"
                            ]
                        ]
                    }
                ],
                "Dimensions": [
                    {
                        "Name": "InstanceId",
                        "Value": {
                            "Ref": "HANAWorkerInstance2"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "871f8de6-5f62-41d2-bc26-161b2f7feeeb"
                }
            }
        },
        "AutoRecoverAlarmWorker3": {
            "Type": "AWS::CloudWatch::Alarm",
            "Condition": "AutoRecoveryWorker3",
            "Properties": {
                "AlarmDescription": "Trigger a recovery when instance status check fails for 5 consecutive minutes.",
                "Namespace": "AWS/EC2",
                "MetricName": "StatusCheckFailed_System",
                "Statistic": "Minimum",
                "Period": "60",
                "EvaluationPeriods": "5",
                "ComparisonOperator": "GreaterThanThreshold",
                "Threshold": "0",
                "AlarmActions": [
                    {
                        "Fn::Join": [
                            "",
                            [
                                "arn:aws:automate:",
                                {
                                    "Ref": "AWS::Region"
                                },
                                ":ec2:recover"
                            ]
                        ]
                    }
                ],
                "Dimensions": [
                    {
                        "Name": "InstanceId",
                        "Value": {
                            "Ref": "HANAWorkerInstance3"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "d17ec5e8-ea91-49c0-9996-ba328e256c69"
                }
            }
        },
        "AutoRecoverAlarmWorker4": {
            "Type": "AWS::CloudWatch::Alarm",
            "Condition": "AutoRecoveryWorker4",
            "Properties": {
                "AlarmDescription": "Trigger a recovery when instance status check fails for 5 consecutive minutes.",
                "Namespace": "AWS/EC2",
                "MetricName": "StatusCheckFailed_System",
                "Statistic": "Minimum",
                "Period": "60",
                "EvaluationPeriods": "5",
                "ComparisonOperator": "GreaterThanThreshold",
                "Threshold": "0",
                "AlarmActions": [
                    {
                        "Fn::Join": [
                            "",
                            [
                                "arn:aws:automate:",
                                {
                                    "Ref": "AWS::Region"
                                },
                                ":ec2:recover"
                            ]
                        ]
                    }
                ],
                "Dimensions": [
                    {
                        "Name": "InstanceId",
                        "Value": {
                            "Ref": "HANAWorkerInstance4"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "9f6ff85c-30e3-4a31-8e39-c217eb35e989"
                }
            }
        },
        "AutoRecoverAlarmWorker5": {
            "Type": "AWS::CloudWatch::Alarm",
            "Condition": "AutoRecoveryWorker5",
            "Properties": {
                "AlarmDescription": "Trigger a recovery when instance status check fails for 5 consecutive minutes.",
                "Namespace": "AWS/EC2",
                "MetricName": "StatusCheckFailed_System",
                "Statistic": "Minimum",
                "Period": "60",
                "EvaluationPeriods": "5",
                "ComparisonOperator": "GreaterThanThreshold",
                "Threshold": "0",
                "AlarmActions": [
                    {
                        "Fn::Join": [
                            "",
                            [
                                "arn:aws:automate:",
                                {
                                    "Ref": "AWS::Region"
                                },
                                ":ec2:recover"
                            ]
                        ]
                    }
                ],
                "Dimensions": [
                    {
                        "Name": "InstanceId",
                        "Value": {
                            "Ref": "HANAWorkerInstance5"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "3edee7ff-a178-47bd-a6af-962be55f04dd"
                }
            }
        },
        "EFSshared": {
            "Type": "AWS::EFS::FileSystem",
            "Properties": {
                "PerformanceMode": "generalPurpose",
                "FileSystemTags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Ref": "HANAMasterHostname"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "b7e0ac04-3eed-40c6-9b48-819c9fd2a529"
                }
            }
        },
        "EFSbackup": {
            "Type": "AWS::EFS::FileSystem",
            "Properties": {
                "PerformanceMode": "generalPurpose",
                "FileSystemTags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Ref": "HANAMasterHostname"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "d0cd4507-66d3-4b97-822d-388d2ccb5f02"
                }
            }
        },
        "EFSMTshared": {
            "Type": "AWS::EFS::MountTarget",
            "Properties": {
                "FileSystemId": {
                    "Ref": "EFSshared"
                },
                "SubnetId": {
                    "Ref": "HANASubnet"
                },
                "SecurityGroups": [
                    {
                        "Ref": "HANASecurityGroup"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "545758ad-8b48-414a-908b-b2f123366aad"
                }
            }
        },
        "EFSMTbackup": {
            "Type": "AWS::EFS::MountTarget",
            "Properties": {
                "FileSystemId": {
                    "Ref": "EFSbackup"
                },
                "SubnetId": {
                    "Ref": "HANASubnet"
                },
                "SecurityGroups": [
                    {
                        "Ref": "HANASecurityGroup"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "2e0ba5e5-ae64-49c3-8e7c-857e1c7dc19f"
                }
            }
        }
    }
}